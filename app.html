<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outil d'√âcriture - Organisation par Chapitres</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600;700&family=Noto+Serif+JP:wght@300;500;700&family=Source+Code+Pro:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Export Libraries -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- IndexedDB wrapper for easier usage -->
    <script src="https://cdn.jsdelivr.net/npm/idb@7/build/umd.js"></script>
    <!-- Excel Support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Mammoth.js for DOCX import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <!-- Lucide Icons - Modern line icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <!-- Google API & Identity Services -->
    <script async defer src="https://apis.google.com/js/api.js"></script>
    <script async defer src="https://accounts.google.com/gsi/client"></script>
    <!-- Driver.js - Product Tour Library (bundled in CSS and JS) -->
    <!-- Generated CSS Links -->
    <link rel="stylesheet" href="./css/driver.css">
<link rel="stylesheet" href="./css/variables.css">
<link rel="stylesheet" href="./css/base.css">
<link rel="stylesheet" href="./css/header.css">
<link rel="stylesheet" href="./css/sidebar.css">
<link rel="stylesheet" href="./css/modals.css">
<link rel="stylesheet" href="./css/editor.css">
<link rel="stylesheet" href="./css/focus-mode.css">
<link rel="stylesheet" href="./css/tabs.css">
<link rel="stylesheet" href="./css/link-panel.css">
<link rel="stylesheet" href="./css/characters.css">
<link rel="stylesheet" href="./css/corkboard.css">
<link rel="stylesheet" href="./css/structure.css">
<link rel="stylesheet" href="./css/mindmap.css">
<link rel="stylesheet" href="./css/arc-detail.css">
<link rel="stylesheet" href="./css/timeline-metro.css">
<link rel="stylesheet" href="./css/utilities.css">
<link rel="stylesheet" href="./css/mobile.css">
<link rel="stylesheet" href="./css/color-palette.css">
<link rel="stylesheet" href="./css/undo-redo.css">
<link rel="stylesheet" href="./css/arc-board.css">
<link rel="stylesheet" href="./css/word-repetition.css">
<link rel="stylesheet" href="./css/product-tour.css">
<link rel="stylesheet" href="./css/investigation-board.css">
<link rel="stylesheet" href="./css/investigation-board.tabs.css">
<link rel="stylesheet" href="./css/documentation-button.css">
<link rel="stylesheet" href="./css/globalnotes.css">
<link rel="stylesheet" href="./css/product-tour-editor.css">
<link rel="stylesheet" href="./css/project-landing.css">
<link rel="stylesheet" href="./css/storygrid.css">
<link rel="stylesheet" href="./css/thriller-board.css">
<link rel="stylesheet" href="./css/theme-manager.css">
<link rel="stylesheet" href="./css/synonyms.css">
<link rel="stylesheet" href="./css/keyboard-shortcuts.css">
<link rel="stylesheet" href="./css/map.css">
<link rel="stylesheet" href="./css/stats.css">
<link rel="stylesheet" href="./css/synonyms.css">
<link rel="stylesheet" href="./css/map.css">
<link rel="stylesheet" href="./css/keyboard-shortcuts.css">
    <script>window.PLUME_DEMO_PROJECT = {
    "id": 1707519130000,
    "title": "Les Cicatrices du Verre",
    "description": "Un thriller haletant o√π un d√©tective doit r√©soudre une affaire de meurtre dans une villa de luxe, pour d√©couvrir une conspiration li√©e √† une technologie de communication imp√©riale disparue.",
    "genre": "Thriller",
    "createdAt": "2026-02-09T22:15:00.000Z",
    "updatedAt": "2026-02-09T22:45:00.000Z",
    "acts": [
        {
            "id": 1,
            "title": "Acte 1 : Le Pi√®ge",
            "createdAt": "2026-02-09T22:15:00.000Z",
            "updatedAt": "2026-02-09T22:15:00.000Z",
            "metadata": {
                "color": "#E53935",
                "description": "L'introduction du myst√®re et la mise en place des personnages."
            },
            "chapters": [
                {
                    "id": 11,
                    "title": "Chapitre 1 : Verre Bris√©",
                    "createdAt": "2026-02-09T22:15:00.000Z",
                    "updatedAt": "2026-02-09T22:15:00.000Z",
                    "metadata": {
                        "description": "Marc d√©couvre la villa d√©vast√©e et les premiers indices."
                    },
                    "scenes": [
                        {
                            "id": 111,
                            "title": "Sc√®ne 1 : L'arriv√©e sur les lieux",
                            "content": "La villa surplombant l'ab√Æme n'√©tait plus que l'ombre de la <span class=\"annotation-marker comment\" data-annotation-id=\"11100201\">splendeur architecturale</span> que Marc avait contempl√©e dans les revues sp√©cialis√©es. Sous une lune livide, elle √©voquait le squelette d'un titan d√©chu, ses poutres m√©talliques fendant les nuages avec une agressivit√© muette. Marc coupa le contact de sa vieille berline, qui s'√©teignit dans un r√¢le d'agonie. Le silence qui s'abattit sur la falaise √©tait glacial, seulement troubl√© par les assauts furieux de l'oc√©an contre la pierre, cent m√®tres plus bas.\n\nIl franchit le ruban de sc√®ne de crime, ses semelles √©crasant les d√©bris de luxe. √Ä mesure qu'il approchait du seuil, le crissement changea de tessiture. Ce n'√©tait plus de la roche, mais du verre. Des myriades d'√©clats stellaires couvraient le sol, comme si une galaxie s'√©tait bris√©e l√†. Mais Marc savait que cette poussi√®re d'√©toiles avait un prix de sang. C'√©tait le cadavre de la baie vitr√©e monumentale, le chef-d'≈ìuvre de Victor Blackwood.\n\nIl s'introduisit dans le hall. L'iode se heurtait √† l'odeur cuivr√©e de la mort. Les techniciens de l'identit√© judiciaire avaient d√©j√† emport√© le corps, mais l'√©cho de la violence demeurait. Le mobilier scandinave gisait √©ventr√©, les toiles de ma√Ætres n'√©taient plus que des lambeaux. Au centre de cette d√©vastation, l√† o√π Blackwood s'√©tait √©teint, les fragments de miroir formeraient un cercle hypnotique autour d'une flaque sombre.\n\nMarc alluma sa torche. La lumi√®re crue l√©cha le b√©ton bross√©, r√©v√©lant les stigmates du combat. Ce n'√©tait pas un vol qui avait d√©rap√©. C'√©tait un abattage, chirurgical et impitoyable. Blackwood, le Magnat du Verre, s'√©tait bris√© parmi ses propres illusions. Marc s'agenouilla devant la tache pourpre, le regard avide. Il cherchait la faille, le grain de sable dans le m√©canisme de cette trag√©die. Car Marc ne croyait pas au hasard ; il lisait les ruines comme un livre ouvert. Et ici, dans ce mausol√©e de cristal, une page l'attendait.",
                            "wordCount": 410,
                            "status": "complete",
                            "activeVersionId": 111002,
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:18:00.000Z",
                            "versions": [
                                {
                                    "id": 111001,
                                    "number": 1,
                                    "label": "Premier Jet",
                                    "content": "La villa de la falaise ne ressemblait plus √† l'≈ìuvre d'art architecturale que Marc avait admir√©e dans les magazines. Sous la lune blafarde, elle ressemblait plut√¥t √† une carcasse de baleine √©chou√©e, dont les c√¥tes d'acier pointaient vers un ciel sans √©toiles. Marc gara sa vieille berline dont le moteur fit entendre un dernier r√¢le de m√©contentement avant de se taire. Le silence qui suivit √©tait lourd, √©pais, interrompu seulement par le ressac de l'Atlantique, cent m√®tres plus bas, contre les rochers ac√©r√©s.\n\nIl franchit le p√©rim√®tre de s√©curit√©, ses chaussures crissant sur les gravillons de l'all√©e. √Ä mesure qu'il approchait de l'entr√©e principale, le bruit changea. Ce n'√©tait plus du gravier, mais du verre. Des milliers de fragments √©tincelants jonchaient le sol, comme si le ciel avait pleur√© des diamants. Mais Marc savait que ce verre n'avait rien de c√©leste. C'√©tait le reste de la baie vitr√©e monumentale, celle qui faisait la bride de Victor Blackwood.\n\nIl p√©n√©tra dans le salon. L'odeur de sel marin se m√™lait √† celle, plus m√©tallique, du sang s√©ch√©. Les policiers √©taient d√©j√† pass√©s, emportant le corps, mais ils avaient laiss√© derri√®re eux une sc√®ne de d√©solation. Le mobilier design √©tait renvers√©, les toiles de ma√Ætres lac√©r√©es. Au centre de la pi√®ce, l√† o√π Blackwood avait √©t√© retrouv√©, les √©clats de verre √©taient plus denses, formant une sorte de halo macabre autour d'une tache sombre.\n\nMarc sortit sa lampe torche. Le faisceau balaya les murs de b√©ton brut, r√©v√©lant des impacts de balles et des griffures profondes. Ce n'√©tait pas un simple cambriolage qui avait mal tourn√©. C'√©tait une ex√©cution, m√©thodique et haineuse. Blackwood, le \"Roi du Cristal\", avait fini sa course au milieu de ses propres cr√©ations, bris√© comme un vulgaire flacon de parfum. Marc s'accroupit pr√®s de la tache de sang, ses yeux scrutant chaque interstice. Il cherchait ce que les experts de la balistique avaient manqu√©, ce d√©tail infime qui ne cadrait pas avec la violence apparente de la sc√®ne. Car Marc ne croyait pas au chaos ; il croyait aux intentions cach√©es derri√®re chaque acte de destruction. Et ici, au milieu de ces ruines de luxe, une intention bien pr√©cise l'attendait.",
                                    "wordCount": 385,
                                    "createdAt": "2026-02-09T22:15:00.000Z",
                                    "isActive": false,
                                    "isFinal": false,
                                    "annotations": []
                                },
                                {
                                    "id": 111002,
                                    "number": 2,
                                    "label": "Version Litt√©raire",
                                    "content": "La villa surplombant l'ab√Æme n'√©tait plus que l'ombre de la <span class=\"annotation-marker comment\" data-annotation-id=\"11100201\">splendeur architecturale</span> que Marc avait contempl√©e dans les revues sp√©cialis√©es. Sous une lune livide, elle √©voquait le squelette d'un titan d√©chu, ses poutres m√©talliques fendant les nuages avec une agressivit√© muette. Marc coupa le contact de sa vieille berline, qui s'√©teignit dans un r√¢le d'agonie. Le silence qui s'abattit sur la falaise √©tait glacial, seulement troubl√© par les assauts furieux de l'oc√©an contre la pierre, cent m√®tres plus bas.\n\nIl franchit le ruban de sc√®ne de crime, ses semelles √©crasant les d√©bris de luxe. √Ä mesure qu'il approchait du seuil, le crissement changea de tessiture. Ce n'√©tait plus de la roche, mais du verre. Des myriades d'√©clats stellaires couvraient le sol, comme si une galaxie s'√©tait bris√©e l√†. Mais Marc savait que cette poussi√®re d'√©toiles avait un prix de sang. C'√©tait le cadavre de la baie vitr√©e monumentale, le chef-d'≈ìuvre de Victor Blackwood.\n\nIl s'introduisit dans le hall. L'iode se heurtait √† l'odeur cuivr√©e de la mort. Les techniciens de l'identit√© judiciaire avaient d√©j√† emport√© le corps, mais l'√©cho de la violence demeurait. Le mobilier scandinave gisait √©ventr√©, les toiles de ma√Ætres n'√©taient plus que des lambeaux. Au centre de cette d√©vastation, l√† o√π Blackwood s'√©tait √©teint, les fragments de miroir formeraient un cercle hypnotique autour d'une flaque sombre.\n\nMarc alluma sa torche. La lumi√®re crue l√©cha le b√©ton bross√©, r√©v√©lant les stigmates du combat. Ce n'√©tait pas un vol qui avait d√©rap√©. C'√©tait un abattage, chirurgical et impitoyable. Blackwood, le Magnat du Verre, s'√©tait bris√© parmi ses propres illusions. Marc s'agenouilla devant la tache pourpre, le regard avide. Il cherchait la faille, le grain de sable dans le m√©canisme de cette trag√©die. Car Marc ne croyait pas au hasard ; il lisait les ruines comme un livre ouvert. Et ici, dans ce mausol√©e de cristal, une page l'attendait.",
                                    "wordCount": 410,
                                    "createdAt": "2026-02-09T22:18:00.000Z",
                                    "isActive": true,
                                    "isFinal": false,
                                    "annotations": [
                                        {
                                            "id": 11100201,
                                            "type": "comment",
                                            "text": "Peut-√™tre un peu trop m√©lodramatique ? √Ä voir √† la relecture.",
                                            "context": "splendeur architecturale",
                                            "completed": false,
                                            "createdAt": "2026-02-09T22:20:00.000Z"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": 112,
                            "title": "Sc√®ne 2 : Le fil rouge",
                            "content": "Le faisceau de la lampe de Marc se figea sur un reflet singulier. Parmi les √©clats de verre transparent et les fragments de cristal de roche qui composaient la collection de Blackwood, une couleur n'avait pas sa place. Une nuance de pourpre, presque organique. Marc sortit une pince de sa poche int√©rieure et, avec une pr√©cision de chirurgien, il √©carta deux morceaux de miroir bris√©.\n\nIncrust√© dans une rainure du parquet, un fil de soie rouge rubis l'attendait. Il √©tait court, √† peine trois centim√®tres, mais sa texture √©tait d'une finesse exceptionnelle. Marc l'approcha de ses yeux. Ce n'√©tait pas un fil de v√™tement ordinaire. C'√©tait de la soie de damas, du genre qu'on n'utilisait plus que dans les ateliers de restauration de la cit√© imp√©riale ou pour des ≈ìuvres d'art textile hors de prix. \n\nCe fil n'avait pas √©t√© laiss√© l√† par m√©garde. Il √©tait trop bien plac√©, presque mis en sc√®ne dans cette anfractuosit√©. Marc sentit une d√©charge d'adr√©naline parcourir son √©chine. Blackwood recevait souvent des personnalit√©s influentes, mais peu d'entre elles portaient de la soie de cette qualit√©, et encore moins pendant une lutte √† mort. √Ä moins que... Marc se rem√©mora la rumeur qui courait les bas-fonds du march√© de l'art quelques semaines plus t√¥t. On murmurait qu'une pi√®ce unique, disparue depuis la chute des tsars, avait refait surface dans une vente priv√©e. On l'appelait \"La Larme du Tsar\", un objet de verre rouge si pur qu'on le confondait avec un rubis g√©ant.\n\nSoudain, un bruit de froissement retentit derri√®re lui. Marc √©teignit sa torche instantan√©ment. Il resta immobile, plongeant dans l'obscurit√© totale, son oreille tendue vers le moindre soupir de l'air de mer dans la carcasse de la villa. Un pas l√©ger, presque imperceptible, se rapprochait. Quelqu'un d'autre s'int√©ressait aux d√©combres de la villa Blackwood. Marc glissa sa main vers son arme, mais ses doigts se referm√®rent plut√¥t sur le sachet de preuves contenant le fil rouge. C'√©tait sa seule piste, son unique lien avec un pass√© que beaucoup auraient pr√©f√©r√© laisser enterr√© sous les d√©bris de cristal. Le visiteur inconnu s'arr√™ta √† l'entr√©e du salon. Marc retint son souffle, le c≈ìur battant contre ses c√¥tes comme un oiseau en cage.",
                            "wordCount": 392,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        }
                    ]
                },
                {
                    "id": 12,
                    "title": "Chapitre 2 : √âchos du Pass√©",
                    "createdAt": "2026-02-09T22:15:00.000Z",
                    "updatedAt": "2026-02-09T22:15:00.000Z",
                    "metadata": {
                        "description": "L'appel √† une experte et la d√©couverte d'une menace technologique."
                    },
                    "scenes": [
                        {
                            "id": 121,
                            "title": "Sc√®ne 1 : L'Experte",
                            "content": "L'atelier d'Elena √©tait une antre de lumi√®re et de chaleur, situ√©e dans une ruelle borgne o√π l'odeur du canal se m√™lait √† celle de l'ozone. C'√©tait un lieu de contrastes, o√π des fours crachant des flammes orang√©es c√¥toyaient des √©tablis couverts de poussi√®re de silice et d'outils d'une autre √©poque. Elena, les cheveux nou√©s dans un foulard de cuir, ne leva pas les yeux de sa pi√®ce en cours quand Marc franchit la porte. Elle maniait une canne √† souffler with the grace d'une chef d'orchestre, transformant une masse incandescente en une sph√®re parfaite.\n\n¬´ Tu es en retard de dix ans, Marc, ¬ª lan√ßa-t-elle, sa voix rauque √©touff√©e par le bruit du ventilateur.\n¬´ Certains disent que je n'arrive jamais, Elena. Je ne fais que passer. ¬ª\nElle d√©posa d√©licatement l'objet fini dans le four de recuisson et se tourna vers lui, essuyant ses mains calleuses sur son tablier. Ses yeux noirs le scann√®rent avec une acuit√© qui mettait Marc mal √† l'aise. Elle n'avait pas chang√©. Toujours cette m√™me autorit√© silencieuse, celle que l'on acquiert en domptant le feu et le sable.\n\nMarc sortit le sachet contenant le fil rouge et le posa sur l'√©tabli. Le visage d'Elena se figea. Elle ne toucha pas le sachet, mais ses narines fr√©mirent. \n¬´ O√π as-tu trouv√© √ßa ? ¬ª demanda-t-elle, le ton soudain d√©pourvu de toute ironie.\n¬´ Chez Blackwood. Juste apr√®s qu'il ait d√©cid√© de mourir au milieu de ses miroirs. ¬ª\nElena s'approcha, sa lampe frontale √©clairant le fil rubis. Ses doigts trembl√®rent l√©g√®rement alors qu'elle saisissait une loupe de bijoutier. Le silence dans l'atelier devint pesant, seulement rompu par le ronronnement des fours.\n¬´ Ce n'est pas un fil de soie, Marc, ¬ª murmura-t-elle. ¬´ Enfin, si, la gaine est en soie. Mais l'√¢me... l'√¢me est faite de fibres de verre optique d'une puret√© que je n'ai vue qu'une fois dans ma vie. Dans les archives de mon grand-p√®re. ¬ª\nElle se redressa, la mine grave.\n¬´ Tu joues avec un feu bien plus br√ªlant que mes fours. Ce fil appartient √† \"L'Araign√©e de Verre\", un r√©seau de faussaires qu'on croyait d√©mantel√© depuis la guerre froide. S'ils sont revenus chez Blackwood, c'est pour une seule raison. ¬ª",
                            "wordCount": 405,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        },
                        {
                            "id": 122,
                            "title": "Sc√®ne 2 : La Larme du Tsar",
                            "content": "Elena s'assit lourdement sur un tabouret haut, ses yeux ne quittant plus le fil rouge. ¬´ La Larme du Tsar n'est pas qu'une l√©gende, Marc. C'√©tait la pi√®ce ma√Ætresse d'un m√©canisme d'optique secret mis au point par les ing√©nieurs de Nicolas II. Pas pour la beaut√©, mais pour la communication. Un syst√®me de r√©flexion de lumi√®re capable d'envoyer des messages crypt√©s √† travers les steppes, ind√©tectable par quiconque ne poss√©dait pas le prisme r√©cepteur. ¬ª\nMarc s'appuya contre une √©tag√®re charg√©e de globes de verre. ¬´ Et Blackwood l'avait ? ¬ª\n¬´ Non. Il essayait de la recr√©er. Il utilisait sa fortune pour financer des recherches sur le verre intelligent. Il pensait pouvoir briser le monopole des communications par satellite avec une technologie vieille de cent ans. Quelqu'un n'aimait pas l'id√©e de voir ressurgir ce fant√¥me. ¬ª\n\nLe t√©l√©phone de Marc vibra violemment dans sa poche. Un num√©ro inconnu s'affichait. Il d√©crocha, s'attendant √† une voix, mais seul un sifflement strident lui r√©pondit, suivi d'une s√©rie de cliquetis rythm√©s. Elena se tendit. \n¬´ Raccroche ! ¬ª cria-t-elle.\nMais il √©tait trop tard. Sur l'√©cran du salon attenant, reli√© √† la cam√©ra de s√©curit√© de la ruelle, une silhouette apparut. Un homme v√™tu d'un manteau long, immobile sous la pluie fine qui commen√ßait √† tomber. Il ne regardait pas l'atelier, il regardait son propre poignet, comme s'il consultait une montre. Ou un d√©tonateur.\n\nSoudain, une onde de choc fit trembler les vitres de l'atelier. Ce n'√©tait pas une explosion massive, mais une fr√©quence vibratoire intense. Les √©tag√®res d'Elena se mirent √† chanter, puis √† hurler. Dans un fracas de cristal, des dizaines d'≈ìuvres de verre explos√®rent simultan√©ment, transformant l'air en une nu√©e de rasoirs volants. Marc se pr√©cipita sur Elena pour la plaquer au sol alors que le plafond de verre de l'atelier c√©dait √† son tour. Au milieu du chaos, le t√©l√©phone de Marc projetait maintenant un laser rouge sur le mur oppos√©, tra√ßant des coordonn√©es g√©ographiques. La menace √©tait claire : le jeu avait commenc√©, et le temps des enqu√™tes discr√®tes √©tait r√©volu. Ils √©taient d√©sormais les proies de l'Araign√©e.",
                            "wordCount": 420,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        }
                    ]
                }
            ]
        },
        {
            "id": 2,
            "title": "Acte 2 : La V√©rit√© √âclat√©e",
            "createdAt": "2026-02-09T22:15:00.000Z",
            "updatedAt": "2026-02-09T22:15:00.000Z",
            "metadata": {
                "color": "#1E88E5",
                "description": "La r√©v√©lation de la conspiration et l'ultime affrontement."
            },
            "chapters": [
                {
                    "id": 21,
                    "title": "Chapitre 3 : La Piste Fragile",
                    "createdAt": "2026-02-09T22:15:00.000Z",
                    "updatedAt": "2026-02-09T22:15:00.000Z",
                    "metadata": {
                        "description": "L'excursion dans le pass√© de Blackwood."
                    },
                    "scenes": [
                        {
                            "id": 211,
                            "title": "Sc√®ne 1 : La Verrerie de l'Oubli",
                            "content": "Les coordonn√©es menaient Marc loin de la c√¥te, au c≈ìur d'une for√™t de conif√®res si denses qu'ils semblaient vouloir √©touffer la lumi√®re du jour. L√†, nich√©e dans un creux de vall√©e, se dressait une ancienne verrerie industrielle, monument de brique rouge et de chemin√©es d√©capit√©es. C'√©tait ici que le \"Roi du Cristal\" avait commenc√© sa carri√®re, bien avant les villas de luxe et les tapis rouges. Le lieu respirait l'abandon, les herbes folles for√ßant le bitume craquel√© du parking.\n\nMarc s'avan√ßa, √©vitant les carcasses de machines rouill√©es. L'air √©tait froid, charg√© d'une humidit√© qui lui gla√ßait les os. Il tenait son arme d'une main ferme, son regard balayant les fen√™tres bris√©es qui ressemblaient √† des orbites vides. Pourquoi Blackwood reviendrait-il ici ? S'agissait-il d'un sanctuaire ou d'une cachette ? Il trouva une porte lat√©rale entrouverte, ses charni√®res g√©missant dans le vent.\n\n√Ä l'int√©rieur, l'atmosph√®re changeait radicalement. Le hall principal, immense, √©tait plong√© dans une p√©nombre bleut√©e. Mais au lieu de la poussi√®re attendue, Marc d√©couvrit un laboratoire de pointe install√© au centre de la nef. Des c√¢bles √† fibre optique couraient sur le sol comme des lianes technologiques, reliant des serveurs silencieux √† une chambre de verre pressuris√©e. Au centre de cette chambre, suspendue par des fils de soie rouge identiques √† celui de la villa, une sph√®re rubis irradiait une lumi√®re pulsante. La Larme du Tsar. Elle n'√©tait pas faite de verre ancien, mais de quelque chose de bien plus moderne : un processeur photonique log√© dans une coque de cristal. Blackwood n'avait pas simplement retrouv√© la Larme ; il l'avait transform√©e en l'arme de communication ultime. Marc s'approcha, fascin√© par la beaut√© toxique de l'objet, ignorant les ombres qui commen√ßaient √† se d√©tacher des piliers de brique.",
                            "wordCount": 395,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        },
                        {
                            "id": 212,
                            "title": "Sc√®ne 2 : L'Embuscade",
                            "content": "Un clic m√©tallique familier figea Marc dans son √©lan. \n¬´ Tr√®s impressionnant, n'est-ce pas ? Une larme de lumi√®re pour un monde de t√©n√®bres. ¬ª\nLa voix sortait d'un haut-parleur dissimul√©, une voix synth√©tique, d√©nu√©e d'√©motion. Marc fit volte-face, son arme point√©e vers la mezzanine. Des faisceaux laser rouges travers√®rent la pi√®ce, convergeant tous sur sa poitrine. Il √©tait pris au pi√®ge. \n\n¬´ Vous avez √©t√© utile, Marc. Vous avez apport√© le dernier composant sans m√™me le savoir. ¬ª\nMarc sentit le sachet dans sa poche. Le fil rouge. Il comprit soudain qu'Elena n'√©tait pas qu'une amie ; elle √©tait la cl√©. Le fil n'√©tait pas une preuve, c'√©tait un capteur. En le d√©pla√ßant, Marc avait activ√© une balise de proximit√©.\nSoudain, les serveurs autour du laboratoire s'emball√®rent. Un sifflement strident emplit la verrerie. Des flammes jaillirent des cuves √† gaz abandonn√©es, transformant instantan√©ment le b√¢timent en une fournaise. Le feu n'√©tait pas accidentel ; c'√©tait un protocole de nettoyage.\n\nMarc n'avait que quelques secondes. Il tira deux balles dans la vitre de la chambre pressuris√©e, mais le verre resta intact. C'√©tait du cristal blind√©. La fum√©e noire commen√ßait √† envahir l'espace, rendant la respiration difficile. Il vit les silhouettes des assaillants se replier vers les sorties de secours, le laissant br√ªler vif avec le secret de Blackwood. Mais Marc avait remarqu√© une chose : la Larme vibrait au m√™me rythme que son t√©l√©phone. Utilisant l'√©cran de son mobile comme un prisme, il dirigea le laser rouge qu'il avait re√ßu plus t√¥t vers le c≈ìur de la sph√®re. L'interaction fut imm√©diate. Une surtension fit craquer le cristal blind√©. Dans une explosion de lumi√®re pourpre, la sph√®re vola en √©clats, brisant la cloison. Marc plongea √† travers les d√©bris, saisissant le noyau de la Larme avant de s'√©lancer vers une fen√™tre haute alors que la structure de la verrerie commen√ßait √† s'effondrer dans un fracas de verre et de flammes.",
                            "wordCount": 415,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        }
                    ]
                },
                {
                    "id": 22,
                    "title": "Chapitre 4 : De l'autre c√¥t√© du miroir",
                    "createdAt": "2026-02-09T22:15:00.000Z",
                    "updatedAt": "2026-02-09T22:15:00.000Z",
                    "metadata": {
                        "description": "La confrontation finale l√† o√π tout bascule."
                    },
                    "scenes": [
                        {
                            "id": 221,
                            "title": "Sc√®ne 1 : La Mise en Sc√®ne",
                            "content": "Tremp√© de sueur, les v√™tements roussis par les flammes, Marc se r√©fugia dans un vieux poste d'observation dominant la vall√©e. Il tenait entre ses mains le noyau de la Larme, un petit prisme qui semblait contenir une galaxie de circuits. En y ins√©rant la carte m√©moire de sa cam√©ra, il parvint √† d√©crypter les derniers fichiers enregistr√©s par Blackwood. Ce qu'il vit le gla√ßa plus s√ªrement que le vent de la for√™t.\n\nLa vid√©o ne montrait pas une attaque. Elle montrait Victor Blackwood, bien vivant, arrangeant lui-m√™me les √©clats de verre dans la villa. Il pla√ßait m√©ticuleusement le fil rouge dans la rainure du parquet. Il configurait les explosifs de l'atelier d'Elena. Blackwood n'√©tait pas la victime ; il √©tait l'architecte de sa propre disparition. Sa \"mort\" √©tait une diversion massive pour effacer ses dettes, √©liminer ses rivaux et surtout, tester son syst√®me de communication en conditions r√©elles.\n\nMarc r√©alisa avec une horreur croissante qu'il avait √©t√© le jouet de Blackwood depuis le d√©but. Le d√©tective mod√®le, l'int√®gre cherchant la v√©rit√©, n'√©tait qu'un pion utilis√© pour transporter le noyau de la verrerie vers un lieu plus s√ªr. Les assaillants √† la verrerie ? Des mercenaires pay√©s pour simuler un combat et s'assurer que Marc s'√©chappe avec l'objet pr√©cieux. Blackwood voulant que Marc \"sauve\" la Larme du Tsar pour l'amener √† son point final de transmission. Marc regarda l'horizon. Au loin, le vieux phare de la Pointe-Noire s'allumait. C'√©tait le point le plus haut de la c√¥te, le seul endroit capable d'envoyer un signal photonique au-del√† de l'horizon. C'√©tait l√† que le Roi du Cristal attendait sa r√©surrection.",
                            "wordCount": 380,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        },
                        {
                            "id": 222,
                            "title": "Sc√®ne 2 : Le Phare de la V√©rit√©",
                            "content": "Le phare de la Pointe-Noire se dressait contre la temp√™te montante. Marc gravit les marches de pierre en colima√ßon, son pas r√©sonnant comme un glas. Arriv√© au sommet, il trouva la galerie de la lanterne baign√©e d'une lumi√®re rouge sang. Victor Blackwood √©tait l√†, debout devant l'optique monumentale du phare, le visage serein. Il tenait une coupe de cristal √† la main.\n\n¬´ Bonjour, Marc. J'appr√©cie votre ponctualit√©. Vous avez le noyau ? ¬ª\nBlackwood ne portait aucune trace de lutte. Il semblait sortir d'un d√Æner de gala. Marc s'arr√™ta √† quelques m√®tres de lui, le prisme de la Larme serr√© dans son poing. \n¬´ Pourquoi Elena ? ¬ª demander Marc d'une voix sourde.\n¬´ Les sacrifices sont n√©cessaires pour l'art, Marc. L'atelier d'Elena √©tait le dernier lien avec l'Araign√©e de Verre. Il fallait que ce chapitre se ferme. Maintenant, donnez-le moi. Le signal va partir dans trois minutes. Une nouvelle √®re de contr√¥le commence. ¬ª \n\nMarc regarda le complexe m√©canisme derri√®re Blackwood. Il aurait pu tirer, mais il savait que Blackwood avait s√ªrement pr√©vu cette issue. Au lieu de cela, Marc sortit le sachet contenant le fil rouge original. \n¬´ Vous avez fait une erreur, Victor. Vous avez cru que je ne verrais que ce que vous vouliez que je voie. Mais vous avez oubli√© que le verre ne fait pas que refl√©ter. Il peut aussi r√©fracter la v√©rit√©. ¬ª \nMarc glissa le fil rouge au c≈ìur du prisme photonique et jeta l'ensemble non pas vers Blackwood, mais directement dans l'engrenage de rotation de la lanterne. Le fil de soie et de verre optique se coin√ßa dans les dents d'acier. Le m√©canisme hurla, une √©tincelle jaillit, et le faisceau lumineux du phare vira soudain au blanc aveuglant avant de s'√©teindre dans un nuage d'ozone.\n\nBlackwood se pr√©cipita vers la lanterne, mais il √©tait trop tard. La surcharge avait grill√© les serveurs. La Larme du Tsar n'√©tait plus qu'un morceau de verre inerte. Le Roi du Cristal s'effondra contre la vitre, regardant la mer redevenue sombre. La police arrivait, leurs gyrophares escaladant la falaise. Marc ne resta pas pour les explications. Il redescendit les marches, laissant derri√®re lui le phare √©teint et le fant√¥me d'un homme qui avait cru pouvoir r√©gner par la lumi√®re. Dehors, la pluie lavait enfin le sang et le verre, laissant le monde tel qu'il √©tait : fragile, mais enfin d√©barrass√© de ses reflets trompeurs.",
                            "wordCount": 435,
                            "status": "complete",
                            "createdAt": "2026-02-09T22:15:00.000Z",
                            "updatedAt": "2026-02-09T22:15:00.000Z"
                        }
                    ]
                }
            ]
        }
    ],
    "characters": [
        {
            "id": "char_marc",
            "name": "Marc Laroque",
            "firstName": "Marc",
            "lastName": "Laroque",
            "role": "Protagoniste / D√©tective",
            "occupation": "D√©tective Priv√©",
            "age": "42",
            "avatarEmoji": "üïµÔ∏è",
            "roleImportance": 5,
            "traits": [
                "Analytique",
                "Obsessionnel",
                "M√©lancolique",
                "Sto√Øque"
            ],
            "personality": {
                "intelligence": 18,
                "force": 12,
                "robustesse": 14,
                "empathie": 8,
                "perception": 19,
                "agilite": 11,
                "sociabilite": 7
            },
            "physicalDescription": "Grand, les traits tir√©s par les insomnies. Porte toujours un imperm√©able gris et semble avoir un train de retard sur le monde, sauf quand il s'agit d'observer des d√©tails.",
            "past": "Ancien inspecteur de la brigade criminelle, il a d√©missionn√© apr√®s une affaire qui a co√ªt√© la vie √† son partenaire. Il vit d√©sormais pour r√©soudre les √©nigmes que les autres consid√®rent comme closes."
        },
        {
            "id": "char_blackwood",
            "name": "Victor Blackwood",
            "firstName": "Victor",
            "lastName": "Blackwood",
            "role": "Antagoniste / Victime pr√©sum√©e",
            "occupation": "Magnat du Verre / Inventeur",
            "age": "58",
            "avatarEmoji": "üíé",
            "roleImportance": 5,
            "traits": [
                "Ambitieux",
                "Manipulateur",
                "Perfectionniste",
                "Visionnaire"
            ],
            "personality": {
                "intelligence": 20,
                "force": 10,
                "robustesse": 12,
                "empathie": 4,
                "perception": 15,
                "agilite": 10,
                "sociabilite": 16
            },
            "physicalDescription": "√âl√©gance aristocratique, cheveux argent√©s parfaitement coiff√©s. Ses mains sont marqu√©es par des micro-cicatrices, stigmates de ses ann√©es de travail du verre.",
            "past": "Fondateur de Blackwood Optique. Il a b√¢ti un empire sur la puret√© de son cristal. Passionn√© par les technologies imp√©riales oubli√©es, il a pass√© sa vie √† chercher la Larme du Tsar."
        },
        {
            "id": "char_elena",
            "name": "Elena Kovalev",
            "firstName": "Elena",
            "lastName": "Kovalev",
            "role": "Alli√©e / Experte",
            "occupation": "Ma√Ætre Verri√®re / Experte en Optique",
            "age": "45",
            "avatarEmoji": "üî•",
            "roleImportance": 4,
            "traits": [
                "Ind√©pendante",
                "R√¢leuse",
                "Loyale",
                "Pr√©cise"
            ],
            "personality": {
                "intelligence": 17,
                "force": 14,
                "robustesse": 16,
                "empathie": 12,
                "perception": 18,
                "agilite": 15,
                "sociabilite": 10
            },
            "physicalDescription": "Bras muscl√©s par le travail au four, regard per√ßant prot√©g√© par des lunettes de protection. Son tablier de cuir porte les traces de mille exp√©rimentations.",
            "past": "Petite-fille d'un ing√©nieur de la cour imp√©riale. Elle seule poss√®de le savoir-faire n√©cessaire pour comprendre les m√©canismes de la Larme du Tsar."
        }
    ],
    "world": [
        {
            "id": "loc_villa",
            "name": "Villa Blackwood",
            "type": "Lieu",
            "description": "Une merveille architecturale perch√©e sur les falaises d'alb√¢tre.",
            "details": "Murs de b√©ton bross√©, baies vitr√©es monumentales offrant une vue plongeante sur l'oc√©an. C'est ici que l'histoire commence avec le meurtre pr√©sum√© de Victor Blackwood.",
            "history": "Construite par Blackwood lui-m√™me comme un laboratoire de lumi√®re et de vie priv√©e."
        },
        {
            "id": "loc_atelier",
            "name": "L'Atelier d'Elena",
            "type": "Lieu",
            "description": "Une verrerie cach√©e dans les quartiers industriels de la ville basse.",
            "details": "Chaleur √©touffante des fours, odeur d'ozone et piles de documents optiques rares. C'est le centre nerveux des recherches techniques de Marc.",
            "history": "Une ancienne fonderie h√©rit√©e par Elena de son grand-p√®re."
        },
        {
            "id": "loc_verrerie",
            "name": "Verrerie de l'Oubli",
            "type": "Lieu",
            "description": "B√¢timent industriel abandonn√© au fond de la for√™t noire.",
            "details": "Enveloppe de briques d√©cr√©pies cachant un laboratoire de photonique de pointe. C'est ici que Blackwood a assembl√© la nouvelle Larme du Tsar.",
            "history": "La premi√®re usine de Blackwood, ferm√©e officiellement il y a vingt ans."
        },
        {
            "id": "loc_phare",
            "name": "Phare de la Pointe-Noire",
            "type": "Lieu",
            "description": "Le plus ancien phare de la c√¥te, dominant les r√©cifs les plus dangereux.",
            "details": "Lanterne monumentale modifi√©e par Blackwood pour servir d'antenne de transmission photonique globale.",
            "history": "Monument historique, site de la confrontation finale."
        }
    ],
    "timeline": [
        {
            "id": 1,
            "title": "Crime √† la Villa",
            "date": "15 Octobre, Minuit",
            "order": 1,
            "description": "Marc arrive √† la villa pour inspecter le cadavre disparu de Blackwood.",
            "characters": [
                "Marc Laroque"
            ]
        },
        {
            "id": 2,
            "title": "L'Indice Rubis",
            "date": "15 Octobre, 02:00",
            "order": 2,
            "description": "D√©couverte du fil de soie rouge incrust√© dans le sol.",
            "characters": [
                "Marc Laroque"
            ]
        },
        {
            "id": 3,
            "title": "Analyse chez Elena",
            "date": "15 Octobre, 10:00",
            "order": 3,
            "description": "Marc apporte le fil √† Elena qui identifie la technologie interdite.",
            "characters": [
                "Marc Laroque",
                "Elena Kovalev"
            ]
        },
        {
            "id": 4,
            "title": "L'Attaque de l'Atelier",
            "date": "15 Octobre, 20:00",
            "order": 4,
            "description": "L'atelier est frapp√© par une fr√©quence vibratoire, destruction massive des ≈ìuvres.",
            "characters": [
                "Marc Laroque",
                "Elena Kovalev"
            ]
        },
        {
            "id": 5,
            "title": "Infiltration de la Verrerie",
            "date": "16 Octobre, 04:00",
            "order": 5,
            "description": "Marc trouve le laboratoire cach√© et la sph√®re photonique.",
            "characters": [
                "Marc Laroque"
            ]
        },
        {
            "id": 6,
            "title": "La diversion de feu",
            "date": "16 Octobre, 05:30",
            "order": 6,
            "description": "Incendie de la verrerie, Marc s'√©chappe de justesse.",
            "characters": [
                "Marc Laroque"
            ]
        },
        {
            "id": 7,
            "title": "D√©cryptage de la Mise en Sc√®ne",
            "date": "16 Octobre, 14:00",
            "order": 7,
            "description": "Marc r√©alise que Blackwood est vivant en analysant les fichiers du prisme.",
            "characters": [
                "Marc Laroque"
            ]
        },
        {
            "id": 8,
            "title": "L'Affrontement Final",
            "date": "16 Octobre, 22:00",
            "order": 8,
            "description": "Le signal du phare est neutralis√©, Blackwood est arr√™t√©.",
            "characters": [
                "Marc Laroque",
                "Victor Blackwood"
            ]
        }
    ],
    "metroTimeline": [
        {
            "id": 101,
            "title": "L'Arriv√©e √† la Villa",
            "date": "15/10/2026",
            "order": 1,
            "description": "Marc Laroque p√©n√®tre dans la demeure de Blackwood sous une pluie battante.",
            "characters": [
                "char_marc"
            ],
            "sceneId": 111
        },
        {
            "id": 102,
            "title": "Expertise Optique",
            "date": "15/10/2026",
            "order": 2,
            "description": "Elena identifie le fil rubis comme une pi√®ce de technologie imp√©riale.",
            "characters": [
                "char_marc",
                "char_elena"
            ],
            "sceneId": 121
        },
        {
            "id": 103,
            "title": "Le Pi√®ge se Referme",
            "date": "15/10/2026",
            "order": 3,
            "description": "Vibrations destructrices dans l'atelier d'Elena. Marc la sauve de justesse.",
            "characters": [
                "char_marc",
                "char_elena"
            ],
            "sceneId": 122
        },
        {
            "id": 104,
            "title": "La Verrerie de l'Oubli",
            "date": "16/10/2026",
            "order": 4,
            "description": "Marc infiltre le laboratoire secret et d√©robe la Larme du Tsar.",
            "characters": [
                "char_marc"
            ],
            "sceneId": 211
        },
        {
            "id": 105,
            "title": "L'Ultime Refraction",
            "date": "16/10/2026",
            "order": 5,
            "description": "Face √† face au sommet du phare. Marc sabote le signal de Blackwood.",
            "characters": [
                "char_marc",
                "char_blackwood"
            ],
            "sceneId": 222
        }
    ],
    "characterColors": {
        "char_marc": "#1E88E5",
        "char_blackwood": "#FB8C00",
        "char_elena": "#43A047"
    },
    "investigationBoard": {
        "activeCaseId": "case_blackwood_murder",
        "cases": [
            {
                "id": "case_blackwood_murder",
                "title": "Le Meurtre du Roi du Cristal",
                "description": "Victor Blackwood a √©t√© retrouv√© mort (ou a disparu) dans sa villa. Sa fortune et ses brevets sont en jeu.",
                "status": "in_progress",
                "phase": "analysis",
                "victimId": "char_blackwood",
                "crimeType": "murder"
            }
        ],
        "facts": [
            {
                "id": "fact_death_blackwood",
                "caseId": "case_blackwood_murder",
                "type": "crime",
                "label": "Mort de Victor Blackwood",
                "description": "Le corps de Victor Blackwood a √©t√© d√©couvert dans son bureau, puis il a disparu.",
                "truthStatus": "verified",
                "relatedCharacterIds": [
                    "char_blackwood"
                ],
                "relatedLocationIds": [
                    "loc_villa"
                ],
                "timeline": [
                    {
                        "id": "step_death_1",
                        "characterId": "char_marc",
                        "sceneId": 111,
                        "state": "revealed",
                        "description": "Marc arrive √† la villa et constate la mort (apparente) de Blackwood."
                    },
                    {
                        "id": "step_death_2",
                        "characterId": "char_marc",
                        "sceneId": 221,
                        "state": "confirmed",
                        "description": "Marc d√©couvre via les fichiers de Blackwood que sa mort √©tait une mise en sc√®ne."
                    }
                ]
            },
            {
                "id": "fact_ruby_thread",
                "caseId": "case_blackwood_murder",
                "type": "clue",
                "label": "Fil de soie rubis",
                "description": "Un fil de soie rouge rubis contenant de la fibre optique ultra-pure.",
                "truthStatus": "verified",
                "relatedCharacterIds": [
                    "char_blackwood",
                    "char_elena"
                ],
                "timeline": [
                    {
                        "id": "step_ruby_1",
                        "characterId": "char_marc",
                        "sceneId": 112,
                        "state": "revealed",
                        "description": "Marc trouve le fil incrust√© dans le parquet de la villa."
                    },
                    {
                        "id": "step_ruby_2",
                        "characterId": "char_elena",
                        "sceneId": 121,
                        "state": "confirmed",
                        "description": "Elena identifie le fil comme de la fibre optique de haute puret√©."
                    }
                ]
            },
            {
                "id": "fact_glass_spider",
                "caseId": "case_blackwood_murder",
                "type": "testimony",
                "label": "L'Araign√©e de Verre",
                "description": "R√©seau de faussaires sp√©cialis√© dans les technologies optiques de la guerre froide.",
                "truthStatus": "verified",
                "timeline": [
                    {
                        "id": "step_spider_1",
                        "characterId": "char_elena",
                        "sceneId": 121,
                        "state": "hinted",
                        "description": "Elena mentionne l'Araign√©e de Verre comme l'origine probable du fil."
                    }
                ]
            },
            {
                "id": "fact_tsar_tear",
                "caseId": "case_blackwood_murder",
                "type": "object",
                "label": "La Larme du Tsar",
                "description": "Un prisme photonique l√©gendaire capable de crypter des communications via la lumi√®re.",
                "truthStatus": "verified",
                "relatedLocationIds": [
                    "loc_verrerie",
                    "loc_phare"
                ],
                "timeline": [
                    {
                        "id": "step_tear_1",
                        "characterId": "char_elena",
                        "sceneId": 122,
                        "state": "hinted",
                        "description": "Elena explique la nature technologique de la Larme du Tsar."
                    },
                    {
                        "id": "step_tear_2",
                        "characterId": "char_marc",
                        "sceneId": 211,
                        "state": "revealed",
                        "description": "Marc d√©couvre la sph√®re rubis (La Larme) dans la verrerie de l'oubli."
                    }
                ]
            }
        ],
        "knowledge": [
            {
                "characterId": "char_marc",
                "factId": "fact_death_blackwood",
                "sceneId": 111,
                "state": "knows"
            },
            {
                "characterId": "char_marc",
                "factId": "fact_ruby_thread",
                "sceneId": 112,
                "state": "knows"
            },
            {
                "characterId": "char_elena",
                "factId": "fact_ruby_thread",
                "sceneId": 121,
                "state": "knows"
            },
            {
                "characterId": "char_marc",
                "factId": "fact_glass_spider",
                "sceneId": 121,
                "state": "suspicious"
            },
            {
                "characterId": "char_elena",
                "factId": "fact_glass_spider",
                "sceneId": 121,
                "state": "knows"
            },
            {
                "characterId": "char_marc",
                "factId": "fact_tsar_tear",
                "sceneId": 122,
                "state": "suspicious"
            },
            {
                "characterId": "char_elena",
                "factId": "fact_tsar_tear",
                "sceneId": 122,
                "state": "knows"
            }
        ],
        "suspectLinks": [
            {
                "id": "mmo_marc_blackwood",
                "caseId": "case_blackwood_murder",
                "suspectId": "char_marc",
                "victimId": "fact_death_blackwood",
                "motive": {
                    "level": 2,
                    "description": "Besoin de cl√¥ture sur une affaire pass√©e impliquant Blackwood."
                },
                "means": {
                    "level": 8,
                    "description": "Poss√®de une arme de service et une connaissance tactique."
                },
                "opportunity": {
                    "level": 5,
                    "description": "√âtait sur place peu apr√®s le crime."
                }
            },
            {
                "id": "mmo_elena_blackwood",
                "caseId": "case_blackwood_murder",
                "suspectId": "char_elena",
                "victimId": "fact_death_blackwood",
                "motive": {
                    "level": 4,
                    "description": "Blackwood utilisait les brevets de sa famille sans compensation."
                },
                "means": {
                    "level": 10,
                    "description": "Capacit√© technique de saboter les verres de la villa."
                },
                "opportunity": {
                    "level": 3,
                    "description": "Alibi de travail dans son atelier, non v√©rifi√©."
                }
            }
        ]
    },
    "plotGrid": {
        "columns": [
            {
                "id": "pg_col_struct",
                "type": "structure",
                "title": "Structure Narrative",
                "order": 0
            },
            {
                "id": "pg_col_spider",
                "type": "custom",
                "title": "Arc A : L'Araign√©e de Verre",
                "order": 1
            },
            {
                "id": "pg_col_tear",
                "type": "custom",
                "title": "Arc B : La Larme du Tsar",
                "order": 2
            },
            {
                "id": "pg_col_chars",
                "type": "custom",
                "title": "Arc C : Marc & Elena",
                "order": 3
            }
        ],
        "rows": [
            {
                "id": "pg_row_111",
                "type": "structure",
                "structureId": 111,
                "structureType": "scene",
                "order": 0
            },
            {
                "id": "pg_row_112",
                "type": "structure",
                "structureId": 112,
                "structureType": "scene",
                "order": 10
            },
            {
                "id": "pg_row_121",
                "type": "structure",
                "structureId": 121,
                "structureType": "scene",
                "order": 20
            },
            {
                "id": "pg_row_122",
                "type": "structure",
                "structureId": 122,
                "structureType": "scene",
                "order": 30
            },
            {
                "id": "pg_row_211",
                "type": "structure",
                "structureId": 211,
                "structureType": "scene",
                "order": 40
            },
            {
                "id": "pg_row_212",
                "type": "structure",
                "structureId": 212,
                "structureType": "scene",
                "order": 50
            },
            {
                "id": "pg_row_221",
                "type": "structure",
                "structureId": 221,
                "structureType": "scene",
                "order": 60
            },
            {
                "id": "pg_row_222",
                "type": "structure",
                "structureId": 222,
                "structureType": "scene",
                "order": 70
            }
        ],
        "cards": [
            {
                "id": "card_1",
                "rowId": "pg_row_111",
                "colId": "pg_col_spider",
                "title": "L'indice pourpre",
                "content": "Marc remarque un fragment de verre qui ne vient pas de la villa."
            },
            {
                "id": "card_2",
                "rowId": "pg_row_112",
                "colId": "pg_col_spider",
                "title": "Le fil rubis",
                "content": "D√©couverte du fil de soie. Premier lien concret avec l'organisation."
            },
            {
                "id": "card_3",
                "rowId": "pg_row_121",
                "colId": "pg_col_chars",
                "title": "Vieilles blessures",
                "content": "Elena et Marc √©voquent leur pass√© commun et la raison de leur rupture."
            },
            {
                "id": "card_4",
                "rowId": "pg_row_121",
                "colId": "pg_col_tear",
                "title": "L'√¢me de verre",
                "content": "Elena r√©v√®le que le fil contient de la fibre optique militaire."
            },
            {
                "id": "card_5",
                "rowId": "pg_row_122",
                "colId": "pg_col_tear",
                "title": "Le projet imp√©rial",
                "content": "Origine de la Larme : un syst√®me de communication par prisme."
            },
            {
                "id": "card_6",
                "rowId": "pg_row_211",
                "colId": "pg_col_tear",
                "title": "Le prototype",
                "content": "Marc trouve la sph√®re dans l'usine d√©saffect√©e. Elle est active."
            },
            {
                "id": "card_7",
                "rowId": "pg_row_221",
                "colId": "pg_col_spider",
                "title": "L'architecte",
                "content": "R√©v√©lation : Blackwood a tout orchestr√©."
            },
            {
                "id": "card_8",
                "rowId": "pg_row_222",
                "colId": "pg_col_spider",
                "title": "Coupure de courant",
                "content": "Marc sabote le signal du phare, neutralisant le r√©seau de l'Araign√©e."
            }
        ]
    },
    "narrativeArcs": [
        {
            "id": "arc_spider",
            "title": "Arc A : L'Araign√©e de Verre",
            "category": "mystery",
            "color": "#607d8b",
            "description": "L'enqu√™te sur le r√©seau de faussaires.",
            "type": "mystery",
            "importance": "major",
            "board": {
                "items": [
                    {
                        "id": "item_1707519130001",
                        "type": "column",
                        "x": 50,
                        "y": 50,
                        "title": "Enqu√™te",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_a1",
                                "type": "scene",
                                "sceneId": 111,
                                "sceneTitle": "Sc√®ne 1 : L'arriv√©e sur les lieux",
                                "breadcrumb": "ACTE 1 : LE PI√àGE ‚Ä∫ CHAPITRE 1 : VERRE BRIS√â",
                                "status": "complete"
                            },
                            {
                                "id": "arc_card_a2",
                                "type": "scene",
                                "sceneId": 112,
                                "sceneTitle": "Sc√®ne 2 : Le fil rouge",
                                "breadcrumb": "ACTE 1 : LE PI√àGE ‚Ä∫ CHAPITRE 1 : VERRE BRIS√â",
                                "status": "complete"
                            }
                        ]
                    },
                    {
                        "id": "item_1707519130002",
                        "type": "column",
                        "x": 710,
                        "y": 50,
                        "title": "3. L'Architecte",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_a7",
                                "type": "scene",
                                "sceneId": 221,
                                "sceneTitle": "Sc√®ne 1 : La Mise en Sc√®ne",
                                "breadcrumb": "ACTE 2 : LA V√âRIT√â √âCLAT√âE ‚Ä∫ CHAPITRE 4",
                                "status": "complete"
                            }
                        ]
                    },
                    {
                        "id": "item_1707519130003",
                        "type": "column",
                        "x": 1040,
                        "y": 50,
                        "title": "4. Sabotage",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_a8",
                                "type": "scene",
                                "sceneId": 222,
                                "sceneTitle": "Sc√®ne 2 : Le Phare de la V√©rit√©",
                                "breadcrumb": "ACTE 2 : LA V√âRIT√â √âCLAT√âE ‚Ä∫ CHAPITRE 4",
                                "status": "complete"
                            }
                        ]
                    }
                ],
                "connections": [
                    {
                        "id": "conn_a1_a2",
                        "from": "item_1707519130001",
                        "fromSide": "right",
                        "to": "item_1707519130002",
                        "toSide": "left"
                    },
                    {
                        "id": "conn_a2_a3",
                        "from": "item_1707519130002",
                        "fromSide": "right",
                        "to": "item_1707519130003",
                        "toSide": "left"
                    }
                ]
            },
            "scenePresence": [
                {
                    "sceneId": 111,
                    "columnId": "item_1707519130001",
                    "intensity": 3
                },
                {
                    "sceneId": 112,
                    "columnId": "item_1707519130001",
                    "intensity": 4
                },
                {
                    "sceneId": 221,
                    "columnId": "item_1707519130002",
                    "intensity": 5
                },
                {
                    "sceneId": 222,
                    "columnId": "item_1707519130003",
                    "intensity": 5
                }
            ]
        },
        {
            "id": "arc_tear",
            "title": "Arc B : La Larme du Tsar",
            "category": "plot",
            "color": "#e74c3c",
            "description": "La technologie photonique et le projet imp√©rial.",
            "type": "plot",
            "importance": "major",
            "board": {
                "items": [
                    {
                        "id": "item_1707519130004",
                        "type": "column",
                        "x": 50,
                        "y": 50,
                        "title": "1. L'√Çme de Verre",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_b4",
                                "type": "scene",
                                "sceneId": 121,
                                "sceneTitle": "Sc√®ne 1 : L'Experte",
                                "breadcrumb": "ACTE 1 : LE PI√àGE ‚Ä∫ CHAPITRE 2",
                                "status": "complete"
                            }
                        ]
                    },
                    {
                        "id": "item_1707519130005",
                        "type": "column",
                        "x": 380,
                        "y": 50,
                        "title": "2. Projet Imp√©rial",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_b5",
                                "type": "scene",
                                "sceneId": 122,
                                "sceneTitle": "Sc√®ne 2 : La Larme du Tsar",
                                "breadcrumb": "ACTE 1 : LE PI√àGE ‚Ä∫ CHAPITRE 2",
                                "status": "complete"
                            }
                        ]
                    },
                    {
                        "id": "item_1707519130006",
                        "type": "column",
                        "x": 710,
                        "y": 50,
                        "title": "3. Le Prototype",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_b6",
                                "type": "scene",
                                "sceneId": 211,
                                "sceneTitle": "Sc√®ne 1 : La Verrerie de l'Oubli",
                                "breadcrumb": "ACTE 2 : LA V√âRIT√â √âCLAT√âE ‚Ä∫ CHAPITRE 3",
                                "status": "complete"
                            }
                        ]
                    }
                ],
                "connections": [
                    {
                        "id": "conn_b1_b2",
                        "from": "item_1707519130004",
                        "fromSide": "right",
                        "to": "item_1707519130005",
                        "toSide": "left"
                    },
                    {
                        "id": "conn_b2_b3",
                        "from": "item_1707519130005",
                        "fromSide": "right",
                        "to": "item_1707519130006",
                        "toSide": "left"
                    }
                ]
            },
            "scenePresence": [
                {
                    "sceneId": 121,
                    "columnId": "item_1707519130004",
                    "intensity": 5
                },
                {
                    "sceneId": 122,
                    "columnId": "item_1707519130005",
                    "intensity": 3
                },
                {
                    "sceneId": 211,
                    "columnId": "item_1707519130006",
                    "intensity": 4
                }
            ]
        },
        {
            "id": "arc_relationship",
            "title": "Arc C : Marc & Elena",
            "category": "relationship",
            "color": "#e91e63",
            "description": "Leurs retrouvailles et l'√©volution de leur dynamique.",
            "type": "relationship",
            "importance": "minor",
            "board": {
                "items": [
                    {
                        "id": "item_1707519130007",
                        "type": "column",
                        "x": 50,
                        "y": 50,
                        "title": "1. Blessures Pass√©es",
                        "width": 260,
                        "cards": [
                            {
                                "id": "arc_card_c3",
                                "type": "scene",
                                "sceneId": 121,
                                "sceneTitle": "Sc√®ne 1 : L'Experte",
                                "breadcrumb": "ACTE 1 : LE PI√àGE ‚Ä∫ CHAPITRE 2",
                                "status": "complete"
                            }
                        ]
                    }
                ],
                "connections": []
            },
            "scenePresence": [
                {
                    "sceneId": 121,
                    "columnId": "item_1707519130007",
                    "intensity": 4
                }
            ]
        }
    ],
    "interArcConnections": [
        {
            "id": "inter_a2_b4",
            "fromArcId": "arc_spider",
            "fromItemId": "arc_card_a2",
            "fromSide": "right",
            "toArcId": "arc_tear",
            "toItemId": "arc_card_b4",
            "toSide": "left",
            "type": "cause",
            "label": "Besoin d'expertise"
        },
        {
            "id": "inter_b6_a7",
            "fromArcId": "arc_tear",
            "fromItemId": "arc_card_b6",
            "fromSide": "right",
            "toArcId": "arc_spider",
            "toItemId": "arc_card_a7",
            "toSide": "left",
            "type": "cause",
            "label": "Preuve accablante"
        },
        {
            "id": "inter_c3_b4",
            "fromArcId": "arc_relationship",
            "fromItemId": "arc_card_c3",
            "fromSide": "right",
            "toArcId": "arc_tear",
            "toItemId": "arc_card_b4",
            "toSide": "left",
            "type": "parallel",
            "label": "Tension partag√©e"
        }
    ],
    "arcCategories": {},
    "collapsedArcCategories": [],
    "notes": [],
    "codex": [],
    "stats": {
        "dailyGoal": 500,
        "totalGoal": 80000,
        "writingSessions": []
    },
    "versions": [],
    "relationships": [],
    "relations": [
        {
            "id": "rel_marc_elena",
            "char1Id": "char_marc",
            "char2Id": "char_elena",
            "type": "amitie",
            "description": "Anciens coll√®gues de confiance. Elena aide Marc √† d√©coder les preuves technologiques.",
            "createdAt": "2026-02-10T21:40:00.000Z"
        },
        {
            "id": "rel_marc_blackwood",
            "char1Id": "char_marc",
            "char2Id": "char_blackwood",
            "type": "rivalite",
            "description": "Marc cherche √† exposer la fraude de Blackwood, tandis que Blackwood le manipule.",
            "createdAt": "2026-02-10T21:40:00.000Z"
        },
        {
            "id": "rel_elena_blackwood",
            "char1Id": "char_elena",
            "char2Id": "char_blackwood",
            "type": "rivalite",
            "description": "Elena m√©prise Blackwood pour avoir exploit√© les brevets de son grand-p√®re.",
            "createdAt": "2026-02-10T21:40:00.000Z"
        }
    ],
    "characterPositions": {
        "char_elena": {
            "x": 300,
            "y": 200
        },
        "char_marc": {
            "x": 550,
            "y": 350
        },
        "char_blackwood": {
            "x": 300,
            "y": 500
        }
    },
    "maps": [
        {
            "id": 1707519130000,
            "name": "Carte de la C√¥te d'Alb√¢tre",
            "image": "https://images.unsplash.com/photo-1526772662000-3f88f10405ff?q=80&w=1000",
            "locations": [
                {
                    "name": "Villa Blackwood",
                    "x": 75,
                    "y": 25,
                    "description": "Perch√©e sur la falaise, point de d√©part de l'enqu√™te.",
                    "typeId": "crime-scene"
                },
                {
                    "name": "L'Atelier d'Elena",
                    "x": 30,
                    "y": 60,
                    "description": "Zone industrielle basse, refuge technique.",
                    "typeId": "hideout"
                },
                {
                    "name": "Verrerie de l'Oubli",
                    "x": 15,
                    "y": 15,
                    "description": "Cach√©e dans la for√™t dense, laboratoire de photonique.",
                    "typeId": "default"
                },
                {
                    "name": "Phare de la Pointe-Noire",
                    "x": 85,
                    "y": 80,
                    "description": "Point culminant de la c√¥te, site de la confrontation finale.",
                    "typeId": "marker"
                }
            ]
        }
    ],
    "globalnotes": {
        "boards": [],
        "items": [],
        "activeBoardId": null
    }
};</script>
</head>
<body>
    <!-- Mobile Menu Handle (poign√©e lat√©rale) -->
    <div class="mobile-menu-handle" onclick="toggleMobileSidebar()"></div>
    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleMobileSidebar()"></div>
    <!-- Mobile Navigation Dropdown (d√©plac√© hors du grid) -->
    <div class="mobile-nav-dropdown" id="mobileNavDropdown">
        <!-- Section √âcriture -->
        <div class="mobile-nav-section">
            <div class="mobile-nav-section-title">
                <i data-lucide="pen-tool"></i>
                <span data-i18n="sidebar.group.write">Ecriture</span>
            </div>
            <div class="mobile-nav-grid">
                <button class="mobile-nav-item" onclick="switchViewMobile('projects')" data-view="projects">
                    <span class="mobile-nav-item-icon"><i data-lucide="folder-open"></i></span>
                    <span data-i18n="nav.projects">Projets</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('editor')" data-view="editor">
                    <span class="mobile-nav-item-icon"><i data-lucide="pen-line"></i></span>
                    <span data-i18n="nav.structure">Structure</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('corkboard')" data-view="corkboard">
                    <span class="mobile-nav-item-icon"><i data-lucide="layout-grid"></i></span>
                    <span data-i18n="nav.corkboard">Tableau</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('characters')" data-view="characters">
                    <span class="mobile-nav-item-icon"><i data-lucide="users"></i></span>
                    <span data-i18n="nav.characters">Personnages</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('globalnotes')" data-view="globalnotes">
                    <span class="mobile-nav-item-icon"><i data-lucide="layout"></i></span>
                    <span data-i18n="nav.globalnotes">Notes Globales</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('front_matter')" data-view="front_matter">
                    <span class="mobile-nav-item-icon"><i data-lucide="book-open-check"></i></span>
                    <span data-i18n="nav.front_matter">Liminaires</span>
                </button>
            </div>
        </div>

        <!-- Section Analyse -->
        <div class="mobile-nav-section">
            <div class="mobile-nav-section-title">
                <i data-lucide="scan-search"></i>
                <span data-i18n="sidebar.group.analyze">Analyse</span>
            </div>
            <div class="mobile-nav-grid">
                <button class="mobile-nav-item" onclick="switchViewMobile('plot')" data-view="plot">
                    <span class="mobile-nav-item-icon"><i data-lucide="trending-up"></i></span>
                    <span data-i18n="nav.plot">Intrigue</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('analysis')" data-view="analysis">
                    <span class="mobile-nav-item-icon"><i data-lucide="scan-search"></i></span>
                    <span data-i18n="nav.analysis">Analyse</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('stats')" data-view="stats">
                    <span class="mobile-nav-item-icon"><i data-lucide="bar-chart-3"></i></span>
                    <span data-i18n="nav.stats">Stats</span>
                </button>
            </div>
        </div>

        <!-- Section Construction -->
        <div class="mobile-nav-section">
            <div class="mobile-nav-section-title">
                <i data-lucide="wrench"></i>
                <span data-i18n="sidebar.group.construction">Construction</span>
            </div>
            <div class="mobile-nav-grid">
                <button class="mobile-nav-item" onclick="switchViewMobile('world')" data-view="world">
                    <span class="mobile-nav-item-icon"><i data-lucide="globe"></i></span>
                    <span data-i18n="nav.world">Univers</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('codex')" data-view="codex">
                    <span class="mobile-nav-item-icon"><i data-lucide="book-open"></i></span>
                    <span data-i18n="nav.codex">Codex</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('notes')" data-view="notes">
                    <span class="mobile-nav-item-icon"><i data-lucide="sticky-note"></i></span>
                    <span data-i18n="nav.notes">Notes</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('arcs')" data-view="arcs">
                    <span class="mobile-nav-item-icon"><i data-lucide="git-commit-horizontal"></i></span>
                    <span data-i18n="nav.arcs">Arcs</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('investigation')" data-view="investigation">
                    <span class="mobile-nav-item-icon"><i data-lucide="search"></i></span>
                    <span data-i18n="nav.investigation">Enqu√™te</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('mindmap')" data-view="mindmap">
                    <span class="mobile-nav-item-icon"><i data-lucide="git-branch"></i></span>
                    <span data-i18n="nav.mindmap">Mindmap</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('relations')" data-view="relations">
                    <span class="mobile-nav-item-icon"><i data-lucide="link"></i></span>
                    <span data-i18n="nav.relations">Relations</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('map')" data-view="map">
                    <span class="mobile-nav-item-icon"><i data-lucide="map"></i></span>
                    <span data-i18n="nav.map">Carte</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('timelineviz')" data-view="timelineviz">
                    <span class="mobile-nav-item-icon"><i data-lucide="clock"></i></span>
                    <span data-i18n="nav.timeline">Timeline</span>
                </button>
                <button class="mobile-nav-item" onclick="switchViewMobile('versions')" data-view="versions">
                    <span class="mobile-nav-item-icon"><i data-lucide="history"></i></span>
                    <span data-i18n="nav.snapshots">Snapshots</span>
                </button>
            </div>
        </div>
    </div>
    <!-- Barre de progression d'√©criture (mode focus) - hors du grid -->
    <div class="writing-progress-bar">
        <div class="writing-progress-fill" id="writingProgressFill"></div>
        <div class="writing-progress-text" id="positionIndicator">Mot 0 / 0</div>
    </div>
    <div class="app-container">
        <!-- Top Header -->
        <div class="app-header">
            <div class="app-logo" onclick="renameProject()" style="cursor: pointer"
                title="Cliquer pour renommer le projet" data-i18n-title="header.logo.title">
                <span class="app-logo-icon"><i data-lucide="feather"></i></span>
                <span id="headerProjectTitle">Plume</span>
                <i data-lucide="pencil" style="width: 12px; height: 12px; opacity: 0.5; margin-left: 4px"></i>
            </div>
            <!-- Mobile Navigation Toggle -->
            <button class="mobile-nav-toggle-btn" onclick="toggleMobileNav()" id="mobileNavToggleBtn">
                <i data-lucide="menu"></i>
            </button>

            <!-- Navigation d√©plac√©e dans l'accord√©on lat√©rale -->
            <div class="header-nav" style="display: none;"></div>

            <!-- Search Bar + Global Actions -->
            <div class="search-container header-search">
                <div class="header-global-actions">
                    <button class="header-action-btn" onclick="undo()" id="headerUndoBtn" title="Annuler (Ctrl+Z)"
                        data-i18n-title="header.undo" disabled>
                        <i data-lucide="undo-2"></i>
                    </button>
                    <button class="header-action-btn" onclick="redo()" id="headerRedoBtn" title="R√©tablir (Ctrl+Y)"
                        data-i18n-title="header.redo" disabled>
                        <i data-lucide="redo-2"></i>
                    </button>
                </div>
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" id="globalSearch"
                        placeholder="Rechercher dans tout le projet..."
                        data-i18n-placeholder="sidebar.search.placeholder" oninput="performGlobalSearch(this.value)"
                        onfocus="this.select()" />
                    <i data-lucide="search" class="search-icon"></i>
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>

            <!-- Actions √† droite -->
            <div class="header-actions">
                <div id="headerStatsContainer"
                    style="font-size: 0.85rem; color: var(--text-muted); margin-right: 0.5rem">
                    <span id="headerTotalWords">0</span>
                    <span id="headerStatsSeparator"> / </span>
                    <span id="headerTotalChapters">0</span>
                </div>
                <!-- Split View Toggle -->
                <button class="split-mode-toggle" onclick="toggleSplitView()" id="splitModeToggle"
                    title="Activer/d√©sactiver le mode split" data-i18n-title="header.split">
                    <i data-lucide="columns-2" style="width: 14px; height: 14px"></i>
                    <span data-i18n="header.split_text">Split</span>
                </button>

                <button class="header-action-btn" onclick="togglePomodoroPopup()" id="pomodoroHeaderBtn"
                    title="Timer Pomodoro" data-i18n-title="header.pomodoro">
                    <i data-lucide="timer"></i>
                </button>




                <!-- Extra Menu Dropdown -->
                <div class="extra-menu-dropdown" id="extraMenuDropdown">
                    <button class="header-action-btn" title="Menu suppl√©mentaire" data-i18n-title="header.extra_menu"
                        onclick="this.parentElement.classList.toggle('open'); event.stopPropagation();">
                        <i data-lucide="more-horizontal"></i>
                    </button>
                    <div class="extra-menu-dropdown-content">
                        <!-- Storage -->
                        <button class="extra-menu-item" id="storage-badge" onclick="showStorageDetails()">
                            <i data-lucide="hard-drive" class="storage-icon"></i>
                            <span data-i18n="header.storage">Stockage</span>
                            <span id="storage-percentage"
                                style="margin-left: auto; font-size: 0.8em; opacity: 0.7;">...</span>
                        </button>
                        <!-- Import -->
                        <button class="extra-menu-item" onclick="openImportChapterModal()" id="headerImportBtn">
                            <i data-lucide="download"></i>
                            <span data-i18n="header.import">Importer un texte</span>
                        </button>
                        <!-- Backup / GDrive -->
                        <button class="extra-menu-item" onclick="ImportExportViewModel.showBackupMenu()"
                            id="headerBackupBtn">
                            <i data-lucide="cloud"></i>
                            <span data-i18n="btn.google_drive">Import/Export & Google Drive</span>
                        </button>
                        <!-- Shortcuts -->
                        <button class="extra-menu-item" onclick="KeyboardShortcutsHandlers.openShortcutsModal()"
                            id="headerShortcutsBtn">
                            <i data-lucide="keyboard"></i>
                            <span data-i18n="header.shortcuts">Raccourcis clavier</span>
                        </button>
                        <!-- Themes -->
                        <button class="extra-menu-item" onclick="openThemeManager()" id="headerThemesBtn">
                            <i data-lucide="palette"></i>
                            <span data-i18n="header.themes">Th√®mes</span>
                        </button>
                        <!-- Interface (d√©plac√© dans la sidebar, bouton d√©sactiv√© ici) -->
                        <!-- <button class="extra-menu-item" onclick="InterfaceCustomizerViewModel.startEditing()"
                            id="headerInterfaceBtn">
                            <i data-lucide="settings-2"></i>
                            <span data-i18n="header.interface">Interface</span>
                        </button> -->

                        <div class="extra-menu-separator"></div>

                        <!-- Language -->
                        <div class="extra-menu-item-group" id="langDropdown">
                            <div class="extra-menu-label">
                                <i data-lucide="languages"></i>
                                <span data-i18n="header.lang.switch">Langue</span>
                            </div>
                            <div class="extra-menu-row-flags">
                                <button class="extra-menu-flag-btn"
                                    onclick="Localization.setLocale('fr'); this.closest('.extra-menu-dropdown').classList.remove('open');"
                                    title="Fran√ßais">üá´üá∑</button>
                                <button class="extra-menu-flag-btn"
                                    onclick="Localization.setLocale('en'); this.closest('.extra-menu-dropdown').classList.remove('open');"
                                    title="English">üá¨üáß</button>
                                <button class="extra-menu-flag-btn"
                                    onclick="Localization.setLocale('de'); this.closest('.extra-menu-dropdown').classList.remove('open');"
                                    title="Deutsch">üá©üá™</button>
                                <button class="extra-menu-flag-btn"
                                    onclick="Localization.setLocale('es'); this.closest('.extra-menu-dropdown').classList.remove('open');"
                                    title="Espa√±ol">üá™üá∏</button>
                            </div>
                        </div>

                        <!-- Documentation -->
                        <div class="extra-menu-item-group" id="docDropdown">
                            <div class="extra-menu-label">
                                <i data-lucide="book-open-text"></i>
                                <span data-i18n="header.documentation">Documentation</span>
                            </div>
                            <div class="extra-menu-row-flags">
                                <a href="doc/fr/" class="extra-menu-flag-btn" target="_blank" title="Fran√ßais">üá´üá∑</a>
                                <a href="doc/en/" class="extra-menu-flag-btn" target="_blank" title="English">üá¨üáß</a>
                                <a href="doc/de/" class="extra-menu-flag-btn" target="_blank" title="Deutsch">üá©üá™</a>
                                <a href="doc/es/" class="extra-menu-flag-btn" target="_blank" title="Espa√±ol">üá™üá∏</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Pomodoro Popup -->
        <div class="pomodoro-popup" id="pomodoroPopup">
            <div class="pomodoro-popup-header">
                <span data-i18n="pomodoro.popup.title">Pomodoro</span>
                <span class="pomodoro-popup-close" onclick="togglePomodoroPopup()"><i data-lucide="x"
                        style="width: 14px; height: 14px"></i></span>
            </div>
            <div class="pomodoro-popup-content">
                <div class="pomodoro-display" id="pomodoroDisplay">25:00</div>
                <div class="pomodoro-controls">
                    <button class="btn btn-small" onclick="startPomodoro()" data-i18n-title="btn.start">
                        <i data-lucide="play" style="width: 14px; height: 14px"></i>
                    </button>
                    <button class="btn btn-small" onclick="pausePomodoro()" data-i18n-title="btn.pause">
                        <i data-lucide="pause" style="width: 14px; height: 14px"></i>
                    </button>
                    <button class="btn btn-small" onclick="resetPomodoro()" data-i18n-title="btn.reset">
                        <i data-lucide="rotate-ccw" style="width: 14px; height: 14px"></i>
                    </button>
                </div>
                <div class="pomodoro-stats">
                    <div class="pomodoro-stat">
                        <span class="pomodoro-stat-value" id="pomodorosCompleted">0</span>
                        <span class="pomodoro-stat-label" data-i18n="pomodoro.stats.sessions">sessions</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Conteneur principal (sidebar + versions + √©diteur) -->
        <div class="app-content">
            <!-- Sidebar Wrapper (Column) -->
            <div class="sidebar-column" id="sidebarColumn">
                <!-- Sidebar Shortcuts (Customize Interface) -->
                <div class="sidebar-shortcuts" id="sidebarShortcuts"></div>

                <!-- Sidebar Accordion (New Navigation) -->
                <div class="sidebar-accordion open" id="sidebarAccordion">
                    <div class="sidebar-accordion-header" onclick="toggleSidebarAccordion()">
                        <div class="sidebar-accordion-title">
                            <i data-lucide="menu" class="accordion-icon"></i>
                            <span id="currentViewTitle">Navigation</span>
                        </div>
                        <i data-lucide="chevron-down" class="accordion-chevron"></i>
                    </div>
                    <div class="sidebar-accordion-content" id="sidebarAccordionContent">
                        <!-- Navigation Items will be injected here via JS -->
                    </div>
                </div>

                <!-- Sidebar Navigation -->
                <div class="sidebar" id="sidebar">
                    <!-- Poign√©e de redimensionnement -->
                    <div class="sidebar-resize-handle" id="sidebarResizeHandle">
                        <div class="resize-handle-line"></div>
                    </div>

                    <!-- Barre de progression globale -->
                    <div class="project-progress-bar" id="projectProgressBar">
                        <div class="progress-stats">
                            <span id="progressStatsText">0 sc√®nes</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-segment complete" id="progressComplete" style="width: 0%">
                            </div>
                            <div class="progress-segment review" id="progressReview" style="width: 0%"></div>
                            <div class="progress-segment progress" id="progressProgress" style="width: 0%">
                            </div>
                            <div class="progress-segment draft" id="progressDraft" style="width: 0%"></div>
                        </div>
                    </div>
                    <!-- Filtres de statut -->
                    <div class="status-filters" id="statusFilters">
                        <button class="status-filter-btn draft active" onclick="toggleStatusFilter('draft')"
                            data-status="draft" title="Brouillon">
                            <span class="status-filter-dot draft"></span>
                            <span data-i18n="sidebar.status.draft">Brouillon</span>
                            <span class="status-filter-count" id="countDraft">0</span>
                        </button>
                        <button class="status-filter-btn progress active" onclick="toggleStatusFilter('progress')"
                            data-status="progress" title="En cours">
                            <span class="status-filter-dot progress"></span>
                            <span data-i18n="sidebar.status.progress">En cours</span>
                            <span class="status-filter-count" id="countProgress">0</span>
                        </button>
                        <button class="status-filter-btn complete active" onclick="toggleStatusFilter('complete')"
                            data-status="complete" title="Termin√©">
                            <span class="status-filter-dot complete"></span>
                            <span data-i18n="sidebar.status.complete">Termin√©</span>
                            <span class="status-filter-count" id="countComplete">0</span>
                        </button>
                        <button class="status-filter-btn review active" onclick="toggleStatusFilter('review')"
                            data-status="review" title="√Ä r√©viser">
                            <span class="status-filter-dot review"></span>
                            <span data-i18n="sidebar.status.review">√Ä r√©viser</span>
                            <span class="status-filter-count" id="countReview">0</span>
                        </button>
                    </div>
                    <!-- Outils de sc√®ne -->
                    <div class="scene-tools" id="sceneTools">
                        <button class="scene-tool-btn" onclick="toggleVersionsSidebar()" id="headerVersionsToggle"
                            title="Afficher/masquer les versions de sc√®ne">
                            <i data-lucide="git-branch"></i>
                            <span data-i18n="tool.versions">Versions</span>
                        </button>
                        <button class="scene-tool-btn" onclick="toggleAnnotationsPanel()" id="sidebarAnnotationsBtn"
                            title="Afficher/masquer les annotations" data-i18n-title="tool.annotations">
                            <i data-lucide="message-square"></i>
                            <span data-i18n="tool.annotations">Annotations</span>
                            <span class="scene-tool-badge" id="annotationsBadge" style="display: none">0</span>
                        </button>
                        <button class="scene-tool-btn" onclick="toggleTodosPanel()" id="sidebarTodosBtn"
                            title="Afficher/masquer les TODOs" data-i18n-title="tool.todos">
                            <i data-lucide="check-square"></i>
                            <span data-i18n="tool.todos">TODOs</span>
                            <span class="scene-tool-badge" id="todosBadge" style="display: none">0</span>
                        </button>
                        <button class="scene-tool-btn" onclick="toggleArcScenePanel()" id="sidebarArcsBtn"
                            title="Afficher/masquer les Arcs Narratifs" data-i18n-title="tool.arcs">
                            <i data-lucide="git-commit-horizontal"></i>
                            <span data-i18n="tool.arcs">Arcs</span>
                        </button>
                        <button class="scene-tool-btn" onclick="PlotGridUI.toggleSidebar()" id="sidebarPlotBtn"
                            title="Afficher/masquer l'Intrigue" data-i18n-title="tool.plot">
                            <i data-lucide="trending-up"></i>
                            <span data-i18n="tool.plot">Intrigue</span>
                        </button>
                        <button class="scene-tool-btn" onclick="InvestigationSidebarUI.toggleSidebar()"
                            id="sidebarInvestigationBtn" title="Afficher/masquer l'Enqu√™te"
                            data-i18n-title="tool.investigation">
                            <i data-lucide="search"></i>
                            <span data-i18n="tool.investigation">Enqu√™te</span>
                        </button>
                    </div>
                    <!-- Boutons d√©plier/replier tout -->
                    <div class="tree-collapse-toolbar" id="treeCollapseToolbar">
                        <button class="tree-collapse-btn" onclick="expandAllTree()" title="Tout d√©plier"
                            data-i18n-title="tool.tree.expand">
                            <i data-lucide="unfold-vertical" style="width: 12px; height: 12px"></i>
                            <span data-i18n="tool.tree.expand">D√©plier</span>
                        </button>
                        <button class="tree-collapse-btn" onclick="collapseAllTree()" title="Tout replier"
                            data-i18n-title="tool.tree.collapse">
                            <i data-lucide="fold-vertical" style="width: 12px; height: 12px"></i>
                            <span data-i18n="tool.tree.collapse">Replier</span>
                        </button>
                        <button class="tree-collapse-btn" onclick="openStructureOrganizer()"
                            title="R√©organiser la structure (vue globale)" data-i18n-title="tool.tree.organize">
                            <i data-lucide="layout-list" style="width: 12px; height: 12px"></i>
                            <span data-i18n="tool.tree.organize">Organiser</span>
                        </button>
                        <button class="tree-collapse-btn tree-customize-btn"
                            onclick="InterfaceCustomizerView.toggleStructureSettings()"
                            title="Personnaliser la vue structure" data-i18n-title="customizer.structure.btn_title"
                            id="structureCustomizeBtn">
                            <i data-lucide="settings-2" style="width: 12px; height: 12px"></i>
                        </button>
                    </div>
                    <div class="chapters-list" id="chaptersList">
                        <!-- Structure will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="frontMatterList" style="display: none">
                        <!-- Front Matter elements will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="charactersList" style="display: none">
                        <!-- Characters will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="worldList" style="display: none">
                        <!-- World elements will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="timelineList" style="display: none">
                        <!-- Timeline events will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="notesList" style="display: none">
                        <!-- Notes will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="codexList" style="display: none">
                        <!-- Codex entries will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="arcsList" style="display: none">
                        <!-- Narrative arcs will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="statsList" style="display: none">
                        <!-- Statistics will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="versionsList" style="display: none">
                        <!-- Versions will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="analysisList" style="display: none">
                        <!-- Analysis will be dynamically inserted here -->
                    </div>
                    <div class="database-list" id="corkboardList" style="display: none">
                        <!-- Cork Board info will be here -->
                    </div>
                    <div class="database-list" id="mindmapList" style="display: none">
                        <!-- Mindmap will be here -->
                    </div>
                    <div class="database-list" id="plotList" style="display: none">
                        <!-- Plot graph will be here -->
                    </div>
                    <div class="database-list" id="relationsList" style="display: none">
                        <!-- Relations graph will be here -->
                    </div>
                    <div class="database-list" id="mapList" style="display: none">
                        <!-- World map will be here -->
                    </div>
                    <div class="database-list" id="timelineVizList" style="display: none">
                        <!-- Visual timeline will be here -->
                    </div>
                    <div class="database-list" id="investigationList" style="display: none">
                        <!-- Investigation cases will be here -->
                    </div>
                    <div class="database-list" id="globalnotesList" style="display: none">
                        <!-- globalnotes boards will be here -->
                    </div>
                    <div class="database-list" id="todosList" style="display: none">
                        <!-- TODOs list will be here -->
                    </div>
                    
                    <div class="database-list" id="noSidebarMessage" style="display: none">
                        <!-- Message for views without sidebar -->
                    </div>
                    <div class="sidebar-actions" id="sidebarActions">
                        <button class="btn btn-primary" onclick="openAddActModal()" data-i18n="btn.add_act">+
                            Acte</button>
                        <button class="btn btn-primary" onclick="openAddChapterModal()" data-i18n="btn.add_chapter">+
                            Chapitre</button>
                        <button class="btn btn-primary" onclick="openAddSceneModalQuick()" data-i18n="btn.add_scene">+
                            Sc√®ne</button>
                    </div>
                </div>
            </div>
            <!-- Vertical Tools Sidebar -->
            <div class="tools-sidebar" id="toolsSidebar">
                <button class="tool-btn" onclick="toggleVersionsSidebar()" id="toolVersionsBtn"
                    title="Versions de sc√®ne" data-i18n-title="tools.versions">
                    <i data-lucide="git-branch"></i>
                    <span class="tool-badge" id="toolVersionsBadge" style="display: none">0</span>
                </button>
                <button class="tool-btn" onclick="toggleAnnotationsPanel()" id="toolAnnotationsBtn" title="Annotations"
                    data-i18n-title="tools.annotations">
                    <i data-lucide="message-square"></i>
                    <span class="tool-badge" id="toolAnnotationsBadge" style="display: none">0</span>
                </button>
                <button class="tool-btn" onclick="toggleTodosPanel()" id="toolTodosBtn" title="TODOs"
                    data-i18n-title="tools.todos">
                    <i data-lucide="check-square"></i>
                    <span class="tool-badge" id="toolTodosBadge" style="display: none">0</span>
                </button>
                <button class="tool-btn" onclick="toggleArcScenePanel()" id="toolArcsBtn" title="Arcs Narratifs"
                    data-i18n-title="tools.arcs">
                    <i data-lucide="git-commit-horizontal"></i>
                    <span class="tool-badge" id="toolArcsBadge" style="display: none">0</span>
                </button>
                <button class="tool-btn" onclick="PlotGridUI.toggleSidebar()" id="toolPlotBtn" title="Plot Grid"
                    data-i18n-title="tools.plot">
                    <i data-lucide="layout-grid"></i>
                    <span class="tool-badge" id="toolPlotBadge" style="display: none">0</span>
                </button>
                <button class="tool-btn" onclick="InvestigationSidebarUI.toggleSidebar()" id="toolInvestigationBtn"
                    title="Enqu√™te" data-i18n-title="tools.investigation">
                    <i data-lucide="search"></i>
                    <span class="tool-badge" id="toolInvestigationBadge" style="display: none">0</span>
                </button>
                <div style="width: 100%; height: 1px; background: var(--border-color); margin: 0.5rem 0"></div>
                <button class="tool-btn" onclick="toggleLinksPanelVisibility()" id="toolLinksPanelBtn"
                    title="Afficher/Masquer les liens (Personnages, Univers, Timeline)" data-i18n-title="tools.links">
                    <i data-lucide="link-2"></i>
                    <span class="tool-badge" id="toolLinksBadge" style="display: none">0</span>
                </button>
                <button class="tool-btn" onclick="toggleWordRepetitionPanel()" id="toolRepetitionBtn"
                    title="Analyseur de r√©p√©titions de mots" data-i18n-title="tools.repetition">
                    <i data-lucide="repeat"></i>
                </button>
            </div>
            <!-- Sidebar Versions (pour les versions de sc√®nes) -->
            <div class="sidebar-versions hidden" id="sidebarVersions">
                <div class="sidebar-versions-header">
                    <div class="sidebar-versions-title">
                        <h3 data-i18n="tool.versions"><i data-lucide="git-branch"
                                style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>Versions
                        </h3>
                        <button class="sidebar-versions-toggle" onclick="toggleVersionsSidebar()" title="Masquer"
                            data-i18n-title="btn.hide">
                            <i data-lucide="x" style="width: 14px; height: 14px"></i>
                        </button>
                    </div>
                    <div class="sidebar-versions-scene" id="versionsSceneName" data-i18n="sidebar.no_scene">
                        Aucune
                        sc√®ne
                        s√©lectionn√©e</div>
                </div>
                <div class="sidebar-versions-actions" id="versionsActionsArea">
                    <button class="btn-new-version" onclick="createSceneVersion()" id="btnNewVersion" disabled
                        data-i18n="btn.new_version">+
                        Nouvelle version</button>
                </div>
                <div class="sidebar-versions-list" id="sceneVersionsList">
                    <div class="versions-no-scene">
                        <div class="versions-no-scene-icon">
                            <i data-lucide="file-text"></i>
                        </div>
                        <div class="versions-no-scene-text" data-i18n="empty.versions_no_scene">S√©lectionnez une
                            sc√®ne<br />dans la structure<br />pour voir
                            ses versions</div>
                    </div>
                </div>
            </div>
            <!-- Sidebar Plot (Dabble Style) -->
            <div class="sidebar-plot hidden" id="sidebarPlot">
                <div class="sidebar-plot-header">
                    <div class="sidebar-plot-title">
                        <h3 data-i18n="tool.plot"><i data-lucide="layout-grid"
                                style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>Plot
                            Grid</h3>
                        <button class="sidebar-plot-toggle" onclick="PlotGridUI.toggleSidebar()" title="Masquer"
                            data-i18n-title="btn.hide">
                            <i data-lucide="x" style="width: 14px; height: 14px"></i>
                        </button>
                    </div>
                    <div class="sidebar-plot-scene" id="plotSidebarSceneName" data-i18n="sidebar.no_scene">
                        Aucune
                        sc√®ne
                        s√©lectionn√©e</div>
                </div>
                <div class="sidebar-plot-list" id="plotSidebarList">
                    <!-- Plot cards will be inserted here -->
                </div>
            </div>
            <!-- Sidebar Investigation -->
            <div class="sidebar-plot hidden" id="sidebarInvestigation">
                <div class="sidebar-plot-header">
                    <div class="sidebar-plot-title">
                        <h3 data-i18n="tool.investigation"><i data-lucide="search"
                                style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>Enqu√™te
                        </h3>
                        <button class="sidebar-plot-toggle" onclick="InvestigationSidebarUI.toggleSidebar()"
                            title="Masquer" data-i18n-title="btn.hide">
                            <i data-lucide="x" style="width: 14px; height: 14px"></i>
                        </button>
                    </div>
                    <div class="sidebar-plot-scene" id="investigationSidebarSceneName" data-i18n="sidebar.no_scene">
                        Aucune sc√®ne s√©lectionn√©e</div>
                </div>
                <div class="sidebar-plot-list" id="investigationSidebarList">
                    <!-- Investigation cards will be inserted here -->
                </div>
            </div>
            <!-- Annotations Panel -->
            <div class="annotations-panel hidden" id="annotationsPanel">
                <div class="annotations-panel-spacer"></div>
                <div class="annotations-panel-content" id="annotationsPanelContent"></div>
            </div>
            <!-- TODOs Panel -->
            <div class="annotations-panel hidden" id="todosPanel">
                <div class="annotations-panel-spacer"></div>
                <div class="annotations-panel-content" id="todosPanelContent"></div>
            </div>
            <!-- Arc Scene Panel -->
            <div id="arcScenePanel" class="arc-scene-panel hidden">
                <div class="arc-scene-panel-header">
                    <h3 data-i18n="tools.arcs_scene_title">Arcs de la sc√®ne</h3>
                    <button class="arc-panel-close" onclick="toggleArcScenePanel()" data-i18n-title="btn.hide">
                        <i data-lucide="x" style="width: 14px; height: 14px"></i>
                    </button>
                </div>
                <div id="arcScenePanelContent" class="arc-scene-panel-content">
                    <!-- Contenu dynamique -->
                </div>
            </div>
            <!-- Links Panel (Sidebar) -->
            <div id="linksPanel" class="links-panel-sidebar hidden">
                <div class="links-panel-header">
                    <h3 data-i18n="tools.links_title"><i data-lucide="link-2"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>Liens
                    </h3>
                    <button class="links-panel-close" onclick="toggleLinksPanelVisibility()" data-i18n-title="btn.hide">
                        <i data-lucide="x" style="width: 14px; height: 14px"></i>
                    </button>
                </div>
                <div id="linksPanelContent" class="links-panel-content">
                    <!-- Contenu dynamique -->
                </div>
            </div>
            <!-- Word Repetition Sidebar (Right Panel) -->
            <div id="wordRepetitionSidebar" class="word-rep-sidebar hidden">
                <div class="word-rep-sidebar-resize" id="wordRepSidebarResize"></div>
                <div class="word-rep-sidebar-header">
                    <div class="word-rep-sidebar-title">
                        <h3 data-i18n="tools.repetition_title"><i data-lucide="repeat"
                                style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>R√©p√©titions
                        </h3>
                        <button class="word-rep-sidebar-close" onclick="toggleWordRepetitionPanel()" title="Fermer"
                            data-i18n-title="btn.close">
                            <i data-lucide="x" style="width: 14px; height: 14px"></i>
                        </button>
                    </div>
                    <div class="word-rep-sidebar-controls">
                        <button class="btn btn-small" onclick="WordRepetitionHandlers.onRefresh()" title="Analyser"
                            data-i18n-title="btn.analyze">
                            <i data-lucide="refresh-cw" style="width: 12px; height: 12px"></i>
                            <span data-i18n="btn.analyze">Analyser</span>
                        </button>
                        <button class="btn btn-icon btn-small" onclick="WordRepetitionHandlers.onToggleSettings()"
                            title="Param√®tres" data-i18n-title="btn.settings">
                            <i data-lucide="settings" style="width: 14px; height: 14px"></i>
                        </button>
                    </div>
                </div>
                <div class="word-rep-sidebar-content" id="wordRepetitionContainer">
                    <!-- Word repetition panel will be dynamically inserted here -->
                </div>
            </div>
            <!-- Main Editor -->
            <div class="editor-container" id="editorView">
                <div class="empty-state">
                    <div class="empty-state-icon"><i data-lucide="pen-tool"></i></div>
                    <div class="empty-state-title" data-i18n="empty.start">Commencez votre histoire</div>
                    <div class="empty-state-text" data-i18n="empty.create_chapter">Cr√©ez votre premier chapitre
                        pour
                        commencer √† √©crire.</div>
                    <button class="btn btn-primary" onclick="openAddChapterModal()" data-i18n="btn.create_chapter">+
                        Cr√©er un
                        chapitre</button>
                </div>
            </div>
        </div>
        <!-- Fin app-content -->
        <!-- Focus Mode Toggle Button -->
        <button class="focus-toggle-btn" onclick="toggleFocusPanel()">
            <i data-lucide="settings"></i>
            <span data-i18n="focus.settings_title">Param√®tres Focus</span>
        </button>
        <!-- Focus Mode Panel (inside app-container for fullscreen) -->
        <div class="focus-mode-panel" id="focusPanel">
            <div class="focus-panel-header">
                <div class="focus-panel-title">
                    <i data-lucide="brain"></i>
                    <span data-i18n="focus.title">Mode Focus</span>
                </div>
            </div>
            <div class="focus-panel-content">
                <!-- Pomodoro Timer -->
                <div class="focus-section">
                    <div class="focus-section-title">
                        <i data-lucide="timer"></i>
                        <span data-i18n="focus.pomodoro_title">Timer Pomodoro</span>
                    </div>
                    <div class="pomodoro-timer">
                        <div class="pomodoro-display" id="pomodoroDisplay">25:00</div>
                        <div class="pomodoro-controls">
                            <button class="btn btn-small" onclick="startPomodoro()">
                                <i data-lucide="play"></i>
                                <span data-i18n="btn.start">D√©marrer</span>
                            </button>
                            <button class="btn btn-small" onclick="pausePomodoro()">
                                <i data-lucide="pause"></i>
                                <span data-i18n="btn.pause">Pause</span>
                            </button>
                            <button class="btn btn-small" onclick="resetPomodoro()">
                                <i data-lucide="rotate-ccw"></i>
                                <span data-i18n="btn.reset">Reset</span>
                            </button>
                        </div>
                        <div class="focus-stats">
                            <div class="focus-stat-box">
                                <div class="focus-stat-value" id="pomodorosCompleted">0</div>
                                <div class="focus-stat-label" data-i18n="focus.stats.pomodoros">Pomodoros</div>
                            </div>
                            <div class="focus-stat-box">
                                <div class="focus-stat-value" id="focusWordCount">0</div>
                                <div class="focus-stat-label" data-i18n="focus.stats.words">Mots</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Focus Settings -->
                <div class="focus-section">
                    <div class="focus-section-title" data-i18n="focus.settings_title">Param√®tres</div>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer">
                            <input type="checkbox" id="hideToolbar" onchange="toggleToolbar()" />
                            <span data-i18n="focus.option.toolbar">Masquer la barre d'outils</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer">
                            <input type="checkbox" id="hideLinksPanel" onchange="toggleLinksPanelVisibility()" />
                            <span data-i18n="focus.option.links">Masquer le panneau de liens</span>
                        </label>
                    </div>
                </div>
                <!-- Exit Focus Mode -->
                <div class="focus-section">
                    <button class="btn btn-primary" style="width: 100%" onclick="toggleFocusMode()">
                        <i data-lucide="arrow-left"></i>
                        <span data-i18n="btn.quit_focus">Quitter le mode Focus</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Fin app-container -->
    <!-- Diff Modal -->
    <div class="diff-modal" id="diffModal" style="display: none">
        <div class="diff-modal-content">
            <div class="diff-modal-header">
                <div class="diff-modal-title">
                    <span><i data-lucide="repeat"></i></span>
                    <span data-i18n="modal.diff.title">Comparaison des versions</span>
                </div>
                <button class="diff-modal-close" id="btnCloseDiffModal" data-i18n-title="btn.close">
                    <i data-lucide="x" style="width: 18px; height: 18px"></i>
                </button>
            </div>
            <div class="diff-toolbar">
                <div class="diff-version-selector">
                    <span data-i18n="modal.diff.compare">Comparer</span>
                    <select class="diff-version-select" id="diffVersionOld"></select>
                    <span data-i18n="modal.diff.with">avec</span>
                    <select class="diff-version-select" id="diffVersionNew"></select>
                </div>
                <div class="diff-stats" id="diffStats">
                    <span class="diff-stat added">+0 ajout√©s</span>
                    <span class="diff-stat removed">‚àí0 supprim√©s</span>
                </div>
                <div class="diff-view-toggle">
                    <button class="diff-view-btn active" id="btnDiffUnified"
                        data-i18n="modal.diff.unified">Unifi√©</button>
                    <button class="diff-view-btn" id="btnDiffSide" data-i18n="modal.diff.sidebyside">C√¥te √†
                        c√¥te</button>
                </div>
            </div>
            <div class="diff-content" id="diffContent">
                <!-- Diff content will be inserted here -->
            </div>
        </div>
    </div>
    <!-- Add Act Modal -->
    <!-- Storage Details Modal -->
    <div class="modal storage-details-modal" id="storage-modal">
        <div class="modal-content" style="max-width: 500px">
            <div class="modal-header">
                <h2>
                    <i data-lucide="save"></i>
                    <span data-i18n="modal.storage.title">Espace de stockage</span>
                </h2>
                <button class="modal-close" onclick="closeModal('storage-modal')" data-i18n-title="btn.close">
                    <i data-lucide="x" style="width: 18px; height: 18px"></i>
                </button>
            </div>
            <div class="storage-info">
                <div class="storage-bar">
                    <div class="storage-bar-fill ok" id="storage-bar-fill" style="width: 0%">
                        <span id="storage-bar-text">0%</span>
                    </div>
                </div>
                <div class="storage-stats">
                    <div class="storage-stat">
                        <div class="storage-stat-label" data-i18n="modal.storage.used">Utilis√©</div>
                        <div class="storage-stat-value" id="storage-used">0 MB</div>
                    </div>
                    <div class="storage-stat">
                        <div class="storage-stat-label" data-i18n="modal.storage.available">Disponible</div>
                        <div class="storage-stat-value" id="storage-available">5 MB</div>
                    </div>
                </div>
                <!-- Section repliable pour les recommandations -->
                <details id="storage-recommendations-details" style="margin-top: 1rem">
                    <summary style="cursor: pointer; font-weight: 600; color: var(--accent-green); font-size: 0.9rem">
                        <i data-lucide="check-circle"
                            style="width: 14px; height: 14px; vertical-align: middle; margin-right: 6px"></i>
                        <span data-i18n="modal.storage.sufficient">Espace suffisant</span>
                    </summary>
                    <div id="storage-recommendations-container" style="margin-top: 0.5rem"></div>
                </details>
            </div>

            <div class="modal-actions" style="margin-top: 1rem">
                <button class="btn" onclick="closeModal('storage-modal')" data-i18n="btn.close">Fermer</button>
            </div>
        </div>
    </div>
    <!-- Modals -->
    <div class="modal" id="addActModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.act.title">Nouvel Acte</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.act.label">Titre de l'acte</label>
                <!-- Placeholder will be handled via JS/or just manually updated for now if static text -->
                <input type="text" class="form-input" id="actTitleInput" placeholder="Acte I : L'√©veil"
                    data-i18n-placeholder="modal.act.placeholder" />
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addActModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addAct()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Add Chapter Modal -->
    <div class="modal" id="addChapterModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.chapter.title">Nouveau Chapitre</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.chapter.label">Titre du chapitre</label>
                <input type="text" class="form-input" id="chapterTitleInput" placeholder="Chapitre 1 : Le D√©but"
                    data-i18n-placeholder="modal.chapter.placeholder" />
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addChapterModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addChapter()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Add Scene Modal -->
    <div class="modal" id="addSceneModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.scene.title">Nouvelle Sc√®ne</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.scene.label">Titre de la sc√®ne</label>
                <input type="text" class="form-input" id="sceneTitleInput" placeholder="Sc√®ne 1 : Rencontre"
                    data-i18n-placeholder="modal.scene.placeholder" />
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addSceneModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addScene()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Split View Selector Modal -->
    <div class="modal" id="splitSelectorModal">
        <div class="modal-content" style="max-width: 600px">
            <div class="modal-title" data-i18n="modal.split_selector.title"><i data-lucide="layout"
                    style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px"></i>Choisir la
                vue
            </div>
            <div id="splitSelectorContent" style="max-height: 600px; overflow-y: auto">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('splitSelectorModal')" data-i18n="btn.cancel">Annuler</button>
            </div>
        </div>
    </div>
    <!-- Add Character Modal -->
    <div class="modal" id="addCharacterModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.character.title">Nouveau Personnage</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.character.name">Nom du personnage</label>
                <input type="text" class="form-input" id="characterNameInput" placeholder="Akiko"
                    data-i18n-placeholder="modal.character.placeholder" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.character.role">R√¥le</label>
                <input type="text" class="form-input" id="characterRoleInput"
                    placeholder="Protagoniste, Antagoniste, Alli√©..."
                    data-i18n-placeholder="modal.character.placeholder_role" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.character.desc">Description rapide</label>
                <textarea class="form-input" id="characterDescInput" placeholder="Description du personnage..."
                    data-i18n-placeholder="modal.character.placeholder_desc" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addCharacterModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addCharacter()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Add World Element Modal -->
    <div class="modal" id="addWorldModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.world.title">Nouvel √©l√©ment d'Univers</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.world.name">Nom</label>
                <input type="text" class="form-input" id="worldNameInput" placeholder="Cit√© de Voile"
                    data-i18n-placeholder="modal.world.placeholder_name" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.world.type">Type</label>
                <select class="form-input" id="worldTypeInput">
                    <option value="Lieu" data-i18n="world.type.place">Lieu</option>
                    <option value="Objet" data-i18n="world.type.object">Objet</option>
                    <option value="Concept" data-i18n="world.type.concept">Concept</option>
                    <option value="Organisation" data-i18n="world.type.organization">Organisation</option>
                    <option value="√âv√©nement" data-i18n="world.type.event">√âv√©nement</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.world.desc">Description rapide</label>
                <textarea class="form-input" id="worldDescInput" placeholder="Description de l'√©l√©ment..."
                    data-i18n-placeholder="modal.world.placeholder_desc" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addWorldModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addWorldElement()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Map Location Modal -->
    <div class="modal" id="locationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="locationModalTitle">
                    <i data-lucide="map-pin"></i>
                    <span data-i18n="modal.location.title">Lieu sur la carte</span>
                </h2>
                <button class="modal-close" onclick="closeModal('locationModal')" data-i18n-title="btn.close">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.location.name">Nom du lieu</label>
                <input type="text" class="form-input" id="locationNameInput" placeholder="Cit√© d'Opaline"
                    data-i18n-placeholder="modal.location.placeholder_name" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.location.type">Type de lieu</label>
                <select class="form-input" id="locationTypeInput">
                    <!-- Populated dynamically by MapView -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.location.desc">Description</label>
                <textarea class="form-input" id="locationDescInput" placeholder="Description courte du lieu..."
                    data-i18n-placeholder="modal.location.placeholder_desc" rows="4"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('locationModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" id="btnSaveLocation"
                    data-i18n="modal.location.btn_save">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Map Configuration Modal -->
    <div class="modal" id="mapConfigModal">
        <div class="modal-content" style="max-width: 700px">
            <div class="modal-header">
                <h2>
                    <i data-lucide="settings"></i>
                    <span data-i18n="modal.map_config.title">G√©rer les types et ic√¥nes</span>
                </h2>
                <button class="modal-close" onclick="closeModal('mapConfigModal')" data-i18n-title="btn.close">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 1.5rem 0">
                <div style="margin-bottom: 2rem">
                    <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--accent-gold)"
                        data-i18n="modal.map_config.category_title">Nouvelle cat√©gorie</h3>
                    <div style="display: flex; gap: 0.5rem">
                        <input type="text" id="newMapCategoryInput" class="form-input" placeholder="Ex: Science-Fiction"
                            data-i18n-placeholder="modal.map_config.placeholder_category" />
                        <button class="btn btn-primary" id="btnAddMapCategory"
                            data-i18n="modal.map_config.btn_add">Ajouter</button>
                    </div>
                </div>

                <div style="margin-bottom: 2rem">
                    <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--accent-gold)"
                        data-i18n="modal.map_config.type_title">Nouveau type</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem">
                        <div class="form-group">
                            <label class="form-label" data-i18n="modal.map_config.name">Nom</label>
                            <input type="text" id="newMapTypeName" class="form-input" placeholder="Ex: Laboratoire"
                                data-i18n-placeholder="modal.map_config.placeholder_type" />
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="modal.map_config.category">Cat√©gorie</label>
                            <select id="newMapTypeCategory" class="form-input"></select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem; margin-bottom: 1rem">
                        <div class="form-group">
                            <label class="form-label" data-i18n="modal.map_config.icon">Ic√¥ne</label>
                            <input type="hidden" id="newMapTypeIconValue" value="map-pin" />
                            <div id="newMapTypeIconGrid" class="icon-selector-grid">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="modal.map_config.color">Couleur</label>
                            <div
                                style="border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 4px; background: var(--bg-primary); display: flex; align-items: center; justify-content: center; height: 120px">
                                <input type="color" id="newMapTypeColor" class="form-input"
                                    style="width: 100%; height: 80px; padding: 2px; cursor: pointer" value="#d4af37" />
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="btnAddMapType" style="width: 100%"
                        data-i18n="modal.map_config.btn_create">Cr√©er ce type</button>
                </div>

                <hr style="border: 0; border-top: 1px solid var(--border-color); margin-bottom: 2rem" />

                <div id="mapTypesListContainer">
                    <!-- List of existing types by category -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('mapConfigModal')" data-i18n="btn.close">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Add Timeline Event Modal -->
    <div class="modal" id="addTimelineModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.timeline.title">Nouvel √©v√©nement</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.timeline.title_label">Titre de l'√©v√©nement</label>
                <input type="text" class="form-input" id="timelineTitleInput" placeholder="La grande bataille"
                    data-i18n-placeholder="modal.timeline.placeholder_title" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.timeline.date">Date / Moment</label>
                <input type="text" class="form-input" id="timelineDateInput"
                    placeholder="An 2157, Printemps / Chapitre 5 / Jour 3..."
                    data-i18n-placeholder="modal.timeline.placeholder_date" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.timeline.location">Localisation</label>
                <input type="text" class="form-input" id="timelineLocationInput" placeholder="Cit√© de Voile"
                    data-i18n-placeholder="modal.timeline.placeholder_location" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.timeline.characters">Personnages impliqu√©s</label>
                <input type="text" class="form-input" id="timelineCharactersInput" placeholder="Akiko, Sora, Kumi..."
                    data-i18n-placeholder="modal.timeline.placeholder_characters" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.timeline.desc">Description</label>
                <textarea class="form-input" id="timelineDescInput" placeholder="Description de l'√©v√©nement..."
                    data-i18n-placeholder="modal.timeline.placeholder_desc" rows="4"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addTimelineModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addTimelineEvent()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Metro Timeline Event Modal -->
    <div class="modal" id="metroEventModal">
        <div class="modal-content" style="max-width: 600px">
            <div class="modal-header">
                <h2 id="metroEventModalTitle">Nouvel √©v√©nement</h2>
                <button class="modal-close" onclick="closeModal('metroEventModal')">&times;</button>
            </div>

            <div class="modal-body">
                <input type="hidden" id="metroEventId" />
                <div class="metro-event-form">
                    <div class="form-group">
                        <label class="form-label">Titre de l'√©v√©nement *</label>
                        <input type="text" class="form-input" id="metroEventTitle" placeholder="La grande bataille" />
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem">
                        <div class="form-group">
                            <label class="form-label">Date / Moment</label>
                            <input type="text" class="form-input" id="metroEventDate"
                                placeholder="An 2157, Printemps..." />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position sur la timeline</label>
                            <select class="form-input" id="metroEventPosition">
                                <!-- Populated dynamically -->
                            </select>
                            <input type="hidden" id="metroEventOrder" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input" id="metroEventDesc" placeholder="Ce qui se passe..."
                            rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Sc√®ne li√©e</label>
                        <select class="form-input" id="metroEventScene">
                            <option value="">Aucune sc√®ne</option>
                            <!-- Populated dynamically -->
                        </select>
                        <small style="color: var(--text-muted); display: block; margin-top: 4px">Associez cet
                            √©v√©nement
                            √† une sc√®ne de votre roman</small>
                    </div>

                    <div class="form-group" style="margin-bottom: 0">
                        <label class="form-label">Personnages impliqu√©s</label>
                        <div id="metroCharactersSelector" class="metro-characters-selector">
                            <!-- Populated dynamically -->
                        </div>
                        <div id="metroLinkedChars" class="metro-linked-chars">
                            <!-- Tags des personnages li√©s -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn" style="background: var(--accent-red); color: white; margin-right: auto"
                    onclick="deleteMetroEvent()" id="metroDeleteBtn">
                    <i data-lucide="trash-2"
                        style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px"></i>
                    <span data-i18n="btn.delete">Supprimer</span>
                </button>
                <button class="btn" onclick="closeModal('metroEventModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="saveMetroEvent()" data-i18n="btn.save">Enregistrer</button>
            </div>
        </div>
    </div>
    <!-- Metro Event View Choice Modal -->
    <div class="modal" id="metroViewChoiceModal">
        <div class="modal-content" style="max-width: 500px">
            <div class="modal-title">Ouvrir l'√©v√©nement Timeline</div>
            <input type="hidden" id="metroViewChoiceEventId" />
            <div style="padding: 1rem 0">
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem">Comment souhaitez-vous visualiser
                    cet
                    √©v√©nement ?</p>
                <div style="display: flex; flex-direction: column; gap: 1rem">
                    <button class="btn" onclick="openMetroEventFullView()"
                        style="padding: 1rem; text-align: left; display: flex; align-items: start; gap: 1rem; border: 2px solid var(--border-color)">
                        <i data-lucide="maximize-2"
                            style="width: 24px; height: 24px; flex-shrink: 0; color: var(--accent-blue)"></i>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem">Vue compl√®te</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted)">Basculer vers la vue
                                Timeline
                                M√©tro (quitte la vue actuelle)</div>
                        </div>
                    </button>
                    <button class="btn" onclick="openMetroEventSplitView()"
                        style="padding: 1rem; text-align: left; display: flex; align-items: start; gap: 1rem; border: 2px solid var(--border-color)">
                        <i data-lucide="columns-2"
                            style="width: 24px; height: 24px; flex-shrink: 0; color: var(--accent-green)"></i>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem">Split-view</div>
                            <div style="font-size: 0.85rem; color: var(--text-muted)">Ouvrir la Timeline en vue
                                s√©par√©e
                                (conserve l'√©diteur)</div>
                        </div>
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('metroViewChoiceModal')">Annuler</button>
            </div>
        </div>
    </div>
    <!-- Metro Character Color Picker Modal -->
    <div class="modal" id="metroColorModal">
        <div class="modal-content" style="max-width: 350px">
            <div class="modal-title">Couleur de la ligne</div>
            <input type="hidden" id="metroColorCharId" />
            <div class="form-group">
                <label class="form-label" id="metroColorCharName">Personnage</label>
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem">
                    <div class="metro-color-option" data-color="#E53935" style="background: #e53935"
                        onclick="selectMetroColor('#E53935')"></div>
                    <div class="metro-color-option" data-color="#D81B60" style="background: #d81b60"
                        onclick="selectMetroColor('#D81B60')"></div>
                    <div class="metro-color-option" data-color="#8E24AA" style="background: #8e24aa"
                        onclick="selectMetroColor('#8E24AA')"></div>
                    <div class="metro-color-option" data-color="#5E35B1" style="background: #5e35b1"
                        onclick="selectMetroColor('#5E35B1')"></div>
                    <div class="metro-color-option" data-color="#3949AB" style="background: #3949ab"
                        onclick="selectMetroColor('#3949AB')"></div>
                    <div class="metro-color-option" data-color="#1E88E5" style="background: #1e88e5"
                        onclick="selectMetroColor('#1E88E5')"></div>
                    <div class="metro-color-option" data-color="#039BE5" style="background: #039be5"
                        onclick="selectMetroColor('#039BE5')"></div>
                    <div class="metro-color-option" data-color="#00ACC1" style="background: #00acc1"
                        onclick="selectMetroColor('#00ACC1')"></div>
                    <div class="metro-color-option" data-color="#00897B" style="background: #00897b"
                        onclick="selectMetroColor('#00897B')"></div>
                    <div class="metro-color-option" data-color="#43A047" style="background: #43a047"
                        onclick="selectMetroColor('#43A047')"></div>
                    <div class="metro-color-option" data-color="#7CB342" style="background: #7cb342"
                        onclick="selectMetroColor('#7CB342')"></div>
                    <div class="metro-color-option" data-color="#C0CA33" style="background: #c0ca33"
                        onclick="selectMetroColor('#C0CA33')"></div>
                    <div class="metro-color-option" data-color="#FDD835" style="background: #fdd835"
                        onclick="selectMetroColor('#FDD835')"></div>
                    <div class="metro-color-option" data-color="#FFB300" style="background: #ffb300"
                        onclick="selectMetroColor('#FFB300')"></div>
                    <div class="metro-color-option" data-color="#FB8C00" style="background: #fb8c00"
                        onclick="selectMetroColor('#FB8C00')"></div>
                    <div class="metro-color-option" data-color="#F4511E" style="background: #f4511e"
                        onclick="selectMetroColor('#F4511E')"></div>
                    <div class="metro-color-option" data-color="#6D4C41" style="background: #6d4c41"
                        onclick="selectMetroColor('#6D4C41')"></div>
                    <div class="metro-color-option" data-color="#757575" style="background: #757575"
                        onclick="selectMetroColor('#757575')"></div>
                    <div class="metro-color-option" data-color="#546E7A" style="background: #546e7a"
                        onclick="selectMetroColor('#546E7A')"></div>
                    <div class="metro-color-option" data-color="#263238" style="background: #263238"
                        onclick="selectMetroColor('#263238')"></div>
                </div>
                <div style="margin-top: 1rem">
                    <label class="form-label">Couleur personnalis√©e</label>
                    <input type="color" id="metroCustomColor" class="form-input"
                        style="width: 100%; height: 40px; padding: 0; cursor: pointer" />
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('metroColorModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="applyMetroColor()" data-i18n="btn.apply">Appliquer</button>
            </div>
        </div>
    </div>
    <style>
        .metro-color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .metro-color-option:hover {
            transform: scale(1.15);
            border-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .metro-color-option.selected {
            border-color: var(--text-primary);
            box-shadow: 0 0 0 2px var(--accent-blue);
        }
    </style>
    <!-- Add Note Modal -->
    <div class="modal" id="addNoteModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.note.title">Nouvelle Note</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.note.label_title">Titre de la note</label>
                <input type="text" class="form-input" id="noteTitleInput"
                    placeholder="Recherche sur les sanctuaires Shinto"
                    data-i18n-placeholder="modal.note.placeholder_title" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.note.label_category">Cat√©gorie</label>
                <select class="form-input" id="noteCategoryInput">
                    <option value="Recherche">Recherche</option>
                    <option value="Id√©e">Id√©e</option>
                    <option value="R√©f√©rence">R√©f√©rence</option>
                    <option value="A faire">A faire</option>
                    <option value="Question">Question</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.note.label_tags">Tags (s√©par√©s par des
                    virgules)</label>
                <input type="text" class="form-input" id="noteTagsInput" placeholder="shinto, religion, japon"
                    data-i18n-placeholder="modal.note.placeholder_tags" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.note.label_content">Contenu</label>
                <textarea class="form-input" id="noteContentInput" placeholder="Contenu de la note..."
                    data-i18n-placeholder="modal.note.placeholder_content" rows="6"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addNoteModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addNote()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>
    <!-- Add Codex Entry Modal -->
    <div class="modal" id="addCodexModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.codex.title">Nouvelle Entr√©e Codex</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.codex.label_title">Titre</label>
                <input type="text" class="form-input" id="codexTitleInput" placeholder="Les Sanctuaires Shinto"
                    data-i18n-placeholder="modal.codex.placeholder_title" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.codex.label_category">Cat√©gorie</label>
                <select class="form-input" id="codexCategoryInput">
                    <option value="Culture" data-i18n="codex.category.Culture">Culture</option>
                    <option value="Histoire" data-i18n="codex.category.Histoire">Histoire</option>
                    <option value="Technologie" data-i18n="codex.category.Technologie">Technologie</option>
                    <option value="G√©ographie" data-i18n="codex.category.G√©ographie">G√©ographie</option>
                    <option value="Politique" data-i18n="codex.category.Politique">Politique</option>
                    <option value="Magie/Pouvoir" data-i18n="codex.category.Magie/Pouvoir">Magie/Pouvoir
                    </option>
                    <option value="Religion" data-i18n="codex.category.Religion">Religion</option>
                    <option value="Soci√©t√©" data-i18n="codex.category.Soci√©t√©">Soci√©t√©</option>
                    <option value="Autre" data-i18n="codex.category.Autre">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.codex.label_summary">R√©sum√© rapide</label>
                <textarea class="form-input" id="codexSummaryInput" placeholder="Description courte..."
                    data-i18n-placeholder="modal.codex.placeholder_summary" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('addCodexModal')" data-i18n="btn.cancel">Annuler</button>
                <button class="btn btn-primary" onclick="addCodexEntry()" data-i18n="btn.create">Cr√©er</button>
            </div>
        </div>
    </div>

    <!-- New Project Modal -->
    <div class="modal" id="newProjectModal">
        <div class="modal-content">
            <div class="modal-title" data-i18n="modal.project.title">Nouveau Projet</div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.project.label_name">Titre du projet</label>
                <input type="text" class="form-input" id="newProjectTitle" placeholder="Mon Roman"
                    data-i18n-placeholder="modal.project.placeholder_name" />
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.project.label_desc">Description (optionnel)</label>
                <textarea class="form-input" id="newProjectDesc" placeholder="Un roman de fantasy √©pique..."
                    data-i18n-placeholder="modal.project.placeholder_desc" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.project.label_genre">Genre</label>
                <select class="form-input" id="newProjectGenre">
                    <option value="">Aucun</option>
                    <option value="Fantasy">Fantasy</option>
                    <option value="Science-Fiction">Science-Fiction</option>
                    <option value="Thriller">Thriller</option>
                    <option value="Romance">Romance</option>
                    <option value="Policier">Policier</option>
                    <option value="Horreur">Horreur</option>
                    <option value="Historique">Historique</option>
                    <option value="Aventure">Aventure</option>
                    <option value="Drame">Drame</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="modal.project.label_template">Utiliser un template
                    ?</label>
                <select class="form-input" id="newProjectTemplate">
                    <option value="" data-i18n="modal.project.template.empty">Projet vide</option>
                    <option value="acts3" data-i18n="modal.project.template.acts3_desc">Structure en 3 Actes
                        (Exposition, Confrontation, R√©solution)</option>
                    <option value="hero_journey" data-i18n="modal.project.template.hero_journey_desc">Le Voyage
                        du
                        H√©ros
                        (12 √©tapes mythiques)</option>
                    <option value="save_the_cat" data-i18n="modal.project.template.save_the_cat_desc">Save the
                        Cat!
                        (Les
                        15 beats de Snyder)</option>
                    <option value="thriller" data-i18n="modal.project.template.thriller_desc">Thriller / Enqu√™te
                        (Suspense & Myst√®re)</option>
                    <option value="romance" data-i18n="modal.project.template.romance_desc">Romance (Rencontre,
                        Tension
                        & Union)</option>
                    <option value="snowflake" data-i18n="modal.project.template.snowflake_desc">M√©thode
                        Snowflake
                        (Construction it√©rative)</option>
                    <option value="scifi" data-i18n="modal.project.template.scifi_desc">Science-Fiction
                        (Worldbuilding
                        avanc√©)</option>
                    <option value="story_circle" data-i18n="modal.project.template.story_circle_desc">Story
                        Circle
                        (Les
                        8 √©tapes de Dan Harmon)</option>
                    <option value="fichtean_curve" data-i18n="modal.project.template.fichtean_curve_desc">Courbe
                        de
                        Fichte (Action & Crises successives)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('newProjectModal')">Annuler</button>
                <button class="btn btn-primary" onclick="createNewProject()">Cr√©er</button>
            </div>
        </div>
    </div>
    <input type="file" id="importProjectInput" accept=".json" style="display: none"
        onchange="handleProjectImport(event)" />
    <!-- Backup Menu Modal -->
    <div class="modal" id="backupModal">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto">
            <div class="modal-title" data-i18n="modal.backup.title"><i data-lucide="hard-drive"></i> Sauvegardes
                et
                Exports</div>
            <div style="margin-bottom: 2rem">
                <div style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary)">
                    <i data-lucide="download"
                        style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                        data-i18n="modal.backup.import_section">Importer des
                        donn√©es</span>
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.75rem">
                    <button class="btn btn-primary" onclick="
                            openImportChapterModal();
                            closeModal('backupModal');
                        " style="font-weight: 600">
                        <i data-lucide="file-text"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                            data-i18n="modal.backup.import_text_btn">Importer un
                            texte (.docx, .txt, .md, .epub)</span>
                    </button>
                    <button class="btn" onclick="importFromFile()"><i data-lucide="folder-open"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                            data-i18n="modal.backup.import_json_btn">Importer
                            depuis un fichier JSON</span></button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none"
                        onchange="handleFileImport(event)" />
                </div>
            </div>
            <div style="margin-bottom: 2rem">
                <div style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary)">
                    <i data-lucide="upload"
                        style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                        data-i18n="modal.backup.export_section">Exporter les
                        donn√©es</span>
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.75rem">
                    <button class="btn btn-primary" onclick="openExportNovelModal()" style="font-weight: 600"><i
                            data-lucide="book-open"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                            data-i18n="modal.backup.export_novel_btn">Exporter le
                            roman (MD, TXT, HTML ...)</span></button>
                    <button class="btn" onclick="exportToJSON()"><i data-lucide="hard-drive"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                            data-i18n="modal.backup.export_json_btn">T√©l√©charger
                            en JSON (sauvegarde compl√®te)</span></button>
                    <button class="btn" onclick="exportProject()"><i data-lucide="file-text"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                            data-i18n="modal.backup.export_txt_btn">Exporter en
                            TXT (texte seulement)</span></button>
                </div>
            </div>
            <div style="margin-bottom: 2rem">
                <div style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary)">
                    <i data-lucide="cloud"
                        style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>Google
                    Drive
                    (Automatique)
                </div>
                <div id="gdrive-container"
                    style="padding: 1rem; background: var(--bg-secondary); border-radius: 4px; border: 1px solid var(--border-color)">
                    <div id="gdrive-logged-out">
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.6"
                            data-i18n="modal.backup.gdrive_desc">
                            Connectez votre compte Google Drive pour sauvegarder automatiquement votre projet
                            dans
                            le
                            cloud.</p>
                        <button class="btn btn-primary" onclick="handleAuthClick()" style="width: 100%">
                            <i data-lucide="log-in"
                                style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i>
                            <span data-i18n="modal.backup.gdrive_login">Se connecter √† Google Drive</span>
                        </button>
                    </div>
                    <div id="gdrive-logged-in" style="display: none">
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem">
                            <div style="display: flex; align-items: center; gap: 0.5rem">
                                <div id="gdrive-user-avatar"
                                    style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-blue); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; overflow: hidden">
                                    <i data-lucide="user" style="width: 16px; height: 16px"></i>
                                </div>
                                <div>
                                    <div id="gdrive-user-name"
                                        style="font-size: 0.85rem; font-weight: 600; color: var(--text-primary)">
                                        Utilisateur Google</div>
                                    <div id="gdrive-user-email" style="font-size: 0.75rem; color: var(--text-muted)">
                                        email@gmail.com</div>
                                </div>
                            </div>
                            <button class="btn btn-small" onclick="handleSignoutClick()" title="D√©connexion"
                                data-i18n-title="modal.backup.gdrive_logout">
                                <i data-lucide="log-out" style="width: 14px; height: 14px"></i>
                            </button>
                        </div>

                        <div
                            style="display: flex; flex-direction: column; gap: 0.75rem; border-top: 1px solid var(--border-color); padding-top: 1rem">
                            <label
                                style="display: flex; align-items: center; justify-content: space-between; cursor: pointer">
                                <div style="display: flex; align-items: center; gap: 0.5rem">
                                    <i data-lucide="refresh-cw"
                                        style="width: 16px; height: 16px; color: var(--accent-green)"></i>
                                    <span style="font-size: 0.9rem; color: var(--text-primary)"
                                        data-i18n="modal.backup.gdrive_auto_save">Sauvegarde
                                        automatique</span>
                                </div>
                                <input type="checkbox" id="gdrive-auto-save"
                                    onchange="toggleGDriveAutoSave(this.checked)"
                                    style="width: 18px; height: 18px; cursor: pointer" />
                            </label>

                            <div id="gdrive-sync-status"
                                style="font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 0.4rem">
                                <i data-lucide="check-circle" style="width: 14px; height: 14px"></i>
                                <span id="gdrive-status-text" data-i18n="modal.backup.gdrive_sync">Synchronis√©</span>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.5rem">
                                <button class="btn btn-small" onclick="syncNowWithGDrive()">
                                    <i data-lucide="upload-cloud"
                                        style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px"></i>
                                    <span data-i18n="modal.backup.gdrive_save_btn">Sauvegarder</span>
                                </button>
                                <button class="btn btn-small" onclick="restoreFromGDrive()">
                                    <i data-lucide="download-cloud"
                                        style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px"></i>
                                    <span data-i18n="modal.backup.gdrive_restore_btn">Restaurer</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="margin-bottom: 2rem">
                <div style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary)">
                    <i data-lucide="help-circle"
                        style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px"></i><span
                        data-i18n="modal.backup.cloud.manual_title">Cloud (manuel)</span>
                </div>
                <div
                    style="padding: 1rem; background: var(--bg-secondary); border-radius: 4px; border: 1px solid var(--border-color)">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.6"
                        data-i18n="modal.backup.cloud.manual_desc">
                        Pour sauvegarder manuellement sur d'autres services cloud :</p>
                    <ol
                        style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.8; padding-left: 1.5rem">
                        <li data-i18n="modal.backup.cloud.manual_step1">Clique sur "T√©l√©charger en JSON"</li>
                        <li data-i18n="modal.backup.cloud.manual_step2">Le fichier contient TOUTES tes donn√©es
                        </li>
                        <li data-i18n="modal.backup.cloud.manual_step3">Uploade-le manuellement sur ton service
                            cloud
                            pr√©f√©r√©</li>
                        <li data-i18n="modal.backup.cloud.manual_step4">Pour restaurer : t√©l√©charge le fichier
                            et
                            utilise "Importer depuis un fichier"</li>
                    </ol>
                </div>
            </div>
            <div
                style="padding: 1rem; background: #fff5f5; border-radius: 4px; border: 1px solid #ffcdd2; margin-top: auto">
                <div
                    style="font-size: 0.85rem; font-weight: 600; color: #c62828; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem">
                    <i data-lucide="alert-triangle" style="width: 16px; height: 16px"></i>
                    <span data-i18n="modal.backup.important_title">Important : Sauvegarde r√©guli√®re</span>
                </div>
                <p style="font-size: 0.8rem; color: #b71c1c; line-height: 1.6" data-i18n="modal.backup.important_text">
                    Le stockage local (IndexedDB) peut √™tre
                    effac√© par le navigateur. L'utilisation du Cloud (Google Drive) est fortement recommand√©e
                    pour
                    ne
                    jamais perdre votre travail.</p>
            </div>
            <div class="modal-actions" style="margin-top: 1.5rem">
                <button class="btn" onclick="closeModal('backupModal')" data-i18n="btn.close">Fermer</button>
            </div>
        </div>
    </div>
    <!-- Import Chapter Modal (multi-format) -->
    <div class="modal" id="importChapterModal">
        <div class="modal-content" style="max-width: 650px; max-height: 85vh; overflow-y: auto">
            <div class="modal-title"><i data-lucide="file-plus"></i> <span data-i18n="modal.import.title">Importer
                    un
                    texte</span></div>
            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.5"
                data-i18n="modal.import.desc">Importez
                votre texte et Plume detectera automatiquement vos chapitres pour creer la structure.</p>
            <div id="importChapterContent">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-actions"
                style="margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1rem">
                <button class="btn" onclick="closeImportChapterModal()">Annuler</button>
            </div>
        </div>
    </div>
    <!-- Export Novel Modal -->
    <div class="modal" id="exportNovelModal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto">
            <div class="modal-title"><i data-lucide="book-open"></i> <span data-i18n="modal.export.title">Exporter
                    votre
                    roman</span></div>
            <p style="font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6"
                data-i18n="modal.export.desc">Vous
                pouvez exporter votre roman dans plusieurs formats. Vous pouvez ensuite importer les donn√©es
                dans
                d'autres logiciels d'√©criture.</p>
            <!-- Toggle All Button -->
            <div style="margin-bottom: 1.5rem">
                <button class="btn btn-small" onclick="toggleAllScenes()" style="width: 100%"
                    data-i18n="modal.export.select_all">Tout s√©lectionner / Tout
                    d√©s√©lectionner</button>
            </div>
            <!-- Acts/Chapters/Scenes Selection Tree -->
            <div style="margin-bottom: 1.5rem; max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 1rem; background: var(--bg-secondary)"
                id="exportTreeContainer">
                <!-- Will be populated by JavaScript -->
            </div>
            <!-- Format Selection -->
            <div style="margin-bottom: 1.5rem">
                <label style="display: block; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary)"
                    data-i18n="modal.export.format_label">
                    Format du fichier </label>
                <select id="exportFormatSelect" onchange="updateExportFormatInfo()"
                    style="width: 100%; padding: 0.75rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.95rem; font-family: &quot;Crimson Pro&quot;, serif">
                    <option value="markdown">Markdown (.md)</option>
                    <option value="txt">Texte brut (.txt)</option>
                    <option value="html">HTML (.html)</option>
                    <option value="epub">EPUB (.epub)</option>
                    <option value="docx">DOCX (.docx)</option>
                </select>
                <div id="formatInfoBox"
                    style="margin-top: 0.75rem; padding: 0.75rem; background: rgba(212, 175, 55, 0.1); border-radius: 4px; border: 1px solid var(--accent-gold); font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5">
                    <strong style="color: var(--text-primary)" data-i18n="modal.export.note.title">Note :</strong>
                    <span data-i18n="modal.export.note.docx_warning">Toutes les fonctionnalit√©s ne sont pas
                        support√©es
                        en format DOCX. Le texte export√© pourrait
                        ne pas ressembler exactement √† l'√©diteur. Pour une compatibilit√© compl√®te, utilisez un autre
                        format.</span>
                </div>
            </div>
            <!-- DOCX Advanced Settings Panel (auto-show when DOCX selected) -->
            <div id="docxSettingsPanel"
                style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; cursor: pointer;"
                    onclick="document.getElementById('docxSettingsInner').style.display = document.getElementById('docxSettingsInner').style.display === 'none' ? 'block' : 'none'">
                    <label style="font-weight: 600; color: var(--text-primary); cursor: pointer;">
                        <i data-lucide="settings-2"
                            style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"></i>
                        <span data-i18n="modal.export.docx.settings_title">Param√®tres DOCX avanc√©s</span>
                    </label>
                    <span style="font-size: 0.8rem; color: var(--text-muted);"
                        data-i18n="modal.export.docx.collapse_hint">cliquer pour d√©plier</span>
                </div>
                <div id="docxSettingsInner" style="display: none;">
                    <!-- Row 1: Page format & Margins -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.page_format">Format de page</label>
                            <select id="docxPageFormat"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="a4" data-i18n="modal.export.docx.page_format.a4">A4 (210 √ó 297 mm)
                                </option>
                                <option value="letter" data-i18n="modal.export.docx.page_format.letter">Letter (8.5
                                    √ó 11
                                    in)</option>
                                <option value="a5" data-i18n="modal.export.docx.page_format.a5">A5 (148 √ó 210 mm)
                                </option>
                                <option value="b5" data-i18n="modal.export.docx.page_format.b5">B5 (176 √ó 250 mm)
                                </option>
                                <option value="poche_11_18" data-i18n="modal.export.docx.page_format.poche_11_18">
                                    Livre
                                    de poche (110 √ó 180 mm)</option>
                                <option value="broche_13_20" data-i18n="modal.export.docx.page_format.broche_13_20">
                                    Broch√© (130 √ó 200 mm)</option>
                                <option value="broche_14_22" data-i18n="modal.export.docx.page_format.broche_14_22">
                                    Broch√© (140 √ó 220 mm)</option>
                                <option value="us_trade" data-i18n="modal.export.docx.page_format.us_trade">US Trade
                                    (6
                                    √ó 9 in)</option>
                                <option value="us_digest" data-i18n="modal.export.docx.page_format.us_digest">US
                                    Digest
                                    (5.5 √ó 8.5 in)</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.margins">Marges</label>
                            <select id="docxMargins"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="narrow" data-i18n="modal.export.docx.margins.narrow">√âtroites (~1.27
                                    cm)
                                </option>
                                <option value="normal" data-i18n="modal.export.docx.margins.normal">Normales (~2.54
                                    cm)
                                </option>
                                <option value="wide" selected data-i18n="modal.export.docx.margins.wide">Larges (~3
                                    cm)
                                </option>
                                <option value="editorial" data-i18n="modal.export.docx.margins.editorial">
                                    √âditoriales
                                    (gauche 4 cm)</option>
                            </select>
                        </div>
                    </div>
                    <!-- Row 2: Font & Size -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.font">Police</label>
                            <select id="docxFont"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="Times New Roman" selected>Times New Roman</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Garamond">Garamond</option>
                                <option value="Palatino Linotype">Palatino Linotype</option>
                                <option value="Book Antiqua">Book Antiqua</option>
                                <option value="Crimson Pro">Crimson Pro</option>
                                <option value="Arial">Arial</option>
                                <option value="Calibri">Calibri</option>
                                <option value="Cambria">Cambria</option>
                                <option value="Courier New">Courier New</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.body_size">Taille du corps</label>
                            <select id="docxBodySize"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="20">10 pt</option>
                                <option value="22">11 pt</option>
                                <option value="24" selected>12 pt</option>
                                <option value="26">13 pt</option>
                                <option value="28">14 pt</option>
                            </select>
                        </div>
                    </div>
                    <!-- Row 3: Line spacing & Indent -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.line_spacing">Interligne</label>
                            <select id="docxLineSpacing"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="240" data-i18n="modal.export.docx.spacing.single">Simple (1.0)
                                </option>
                                <option value="276" data-i18n="modal.export.docx.spacing.1_15">1.15</option>
                                <option value="360" selected data-i18n="modal.export.docx.spacing.1_5">1.5</option>
                                <option value="480" data-i18n="modal.export.docx.spacing.double">Double (2.0)
                                </option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.indent">Alin√©a (1√®re ligne)</label>
                            <select id="docxIndent"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="0" data-i18n="modal.export.docx.indent.none">Aucun</option>
                                <option value="360" data-i18n="modal.export.docx.indent.small">~0.63 cm</option>
                                <option value="709" selected data-i18n="modal.export.docx.indent.standard">~1.25 cm
                                    (Standard)</option>
                                <option value="1440" data-i18n="modal.export.docx.indent.large">~2.54 cm</option>
                            </select>
                        </div>
                    </div>
                    <!-- Row 4: Header & Footer -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.header_content">En-t√™te</label>
                            <select id="docxHeaderContent"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="title" selected data-i18n="modal.export.docx.header.title">Titre du
                                    roman
                                </option>
                                <option value="author" data-i18n="modal.export.docx.header.author">Nom de l'auteur
                                </option>
                                <option value="title_author" data-i18n="modal.export.docx.header.both">Titre ‚Äî
                                    Auteur
                                </option>
                                <option value="none" data-i18n="modal.export.docx.header.none">Aucun</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                                data-i18n="modal.export.docx.footer">Pied de page</label>
                            <select id="docxFooter"
                                style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.9rem;">
                                <option value="pagenum" selected data-i18n="modal.export.docx.footer.pagenum">Num√©ro
                                    de
                                    page</option>
                                <option value="none" data-i18n="modal.export.docx.footer.none">Aucun</option>
                            </select>
                        </div>
                    </div>
                    <!-- Row 5: Page Breaks -->
                    <div style="margin-bottom: 0.75rem;">
                        <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                            data-i18n="modal.export.docx.page_breaks">Sauts de page</label>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <label
                                style="display: flex; align-items: center; gap: 0.4rem; cursor: pointer; font-size: 0.9rem;">
                                <input type="checkbox" id="docxBreakBeforeAct" checked style="cursor: pointer;" />
                                <span data-i18n="modal.export.docx.break_act">Avant chaque acte</span>
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.4rem; cursor: pointer; font-size: 0.9rem;">
                                <input type="checkbox" id="docxBreakBeforeChapter" checked style="cursor: pointer;" />
                                <span data-i18n="modal.export.docx.break_chapter">Avant chaque chapitre</span>
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.4rem; cursor: pointer; font-size: 0.9rem;">
                                <input type="checkbox" id="docxBreakBeforeScene" style="cursor: pointer;" />
                                <span data-i18n="modal.export.docx.break_scene">Avant chaque sc√®ne</span>
                            </label>
                        </div>
                    </div>
                    <!-- Row 6: Front Matter -->
                    <div style="margin-bottom: 0.5rem;">
                        <label style="font-size: 0.85rem; font-weight: 500; display: block; margin-bottom: 0.3rem;"
                            data-i18n="modal.export.docx.front_matter_title">Pages liminaires</label>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <label
                                style="display: flex; align-items: center; gap: 0.4rem; cursor: pointer; font-size: 0.9rem;">
                                <input type="checkbox" id="docxIncludeTitlePage" checked style="cursor: pointer;" />
                                <span data-i18n="modal.export.docx.title_page">Page de titre</span>
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 0.4rem; cursor: pointer; font-size: 0.9rem;">
                                <input type="checkbox" id="docxIncludeFrontMatter" checked style="cursor: pointer;" />
                                <span data-i18n="modal.export.docx.front_matter">D√©dicace, √©pigraphe‚Ä¶</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <!-- General Options -->
            <div style="margin-bottom: 1.5rem">
                <label style="display: block; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary)"
                    data-i18n="modal.export.options_label">
                    Options g√©n√©rales </label>
                <div style="display: flex; flex-direction: column; gap: 0.5rem">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="exportSummariesCheck" style="cursor: pointer" />
                        <span data-i18n="modal.export.summaries">Exporter les r√©sum√©s</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="exportProseCheck" checked style="cursor: pointer" />
                        <span data-i18n="modal.export.prose">Exporter le texte</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeActTitlesCheck" checked style="cursor: pointer" />
                        <span data-i18n="modal.export.act_titles">Inclure les titres d'actes <span
                                style="color: var(--text-muted); font-size: 0.85rem">(d√©sactiver pour ex.
                                Vellum,
                                Atticus)</span></span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeSceneSubtitlesCheck" checked style="cursor: pointer" />
                        <span data-i18n="modal.export.scene_subtitles">Inclure les sous-titres de sc√®nes</span>
                    </label>
                </div>
            </div>
            <!-- Scene Dividers -->
            <div style="margin-bottom: 1.5rem">
                <label style="display: block; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary)"
                    data-i18n="modal.export.dividers_label">
                    S√©parateurs de sc√®nes </label>
                <select id="sceneDividerSelect"
                    style="width: 100%; padding: 0.75rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.95rem; font-family: &quot;Crimson Pro&quot;, serif">
                    <option value="asterisks">Ast√©risques ( * * * )</option>
                    <option value="hash">Di√®se ( ### )</option>
                    <option value="line">Ligne horizontale (---)</option>
                    <option value="space">Espace vide</option>
                    <option value="none">Aucun s√©parateur</option>
                </select>
            </div>
            <!-- Project Export (ZIP with all data) -->
            <div
                style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 6px; border: 1px solid var(--border-color)">
                <label style="display: block; font-weight: 600; margin-bottom: 0.75rem; color: var(--text-primary)"
                    data-i18n="modal.export.full_project_label">
                    Export du projet complet </label>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.5"
                    data-i18n="modal.export.full_project_desc">En
                    exportant le projet complet, le fichier r√©sultant sera une archive ZIP contenant tout le
                    contenu
                    s√©lectionn√©.</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeCharactersCheck" style="cursor: pointer" />
                        <span>Personnages</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeWorldCheck" style="cursor: pointer" />
                        <span>Univers</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeTimelineCheck" style="cursor: pointer" />
                        <span>Timeline</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeRelationsCheck" style="cursor: pointer" />
                        <span>Relations</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeCodexCheck" style="cursor: pointer" />
                        <span>Codex</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.95rem">
                        <input type="checkbox" id="includeNotesCheck" style="cursor: pointer" />
                        <span>Notes</span>
                    </label>
                </div>
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed var(--border-color)">
                    <button onclick="toggleAllExportOptions(true)" class="btn btn-small"
                        style="margin-right: 0.5rem; font-size: 0.8rem; padding: 0.3rem 0.6rem">Tout
                        s√©lectionner</button>
                    <button onclick="toggleAllExportOptions(false)" class="btn btn-small"
                        style="font-size: 0.8rem; padding: 0.3rem 0.6rem">Tout d√©s√©lectionner</button>
                </div>
            </div>
            <!-- Export Button -->
            <div style="text-align: center; padding-top: 1rem; border-top: 1px solid var(--border-color)">
                <button class="btn btn-primary" onclick="executeNovelExport()"
                    style="padding: 0.75rem 2rem; font-size: 1rem; font-weight: 600"
                    data-i18n="btn.create">Exporter</button>
            </div>
            <div class="modal-actions" style="margin-top: 1rem">
                <button class="btn" onclick="closeModal('exportNovelModal')">Annuler</button>
            </div>
        </div>
    </div>
    <!-- Tension Words Editor Modal -->
    <div class="modal" id="tensionWordsModal">
        <div class="modal-content" style="max-width: 900px">
            <div class="modal-title" data-i18n="modal.tension.title"><i data-lucide="pencil"></i> Personnaliser
                les
                mots
                de tension</div>
            <div
                style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 6px; border: 1px solid var(--border-color)">
                <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; margin: 0">Ces mots
                    sont
                    utilis√©s pour calculer automatiquement la tension narrative de vos sc√®nes. Personnalisez-les
                    selon
                    votre style d'√©criture et le genre de votre roman.</p>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem">
                <!-- High Tension Words -->
                <div
                    style="background: var(--bg-secondary); border-radius: 8px; padding: 1.25rem; border: 2px solid rgba(196, 69, 54, 0.3)">
                    <h3
                        style="margin: 0 0 0.75rem 0; font-size: 1rem; color: var(--accent-red); display: flex; align-items: center; gap: 0.5rem">
                        Haute tension
                        <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: normal">(+3 pts
                            chacun)</span>
                    </h3>
                    <div style="margin-bottom: 0.75rem">
                        <input type="text" id="highTensionInput" placeholder="Ajouter un mot..."
                            style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem"
                            onkeypress="if (event.key === 'Enter') addTensionWord('high');" />
                        <button onclick="addTensionWord('high')"
                            style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: var(--accent-red); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 500">+
                            Ajouter</button>
                        <button onclick="openBulkImport('high')"
                            style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: rgba(196, 69, 54, 0.2); color: var(--accent-red); border: 1px solid var(--accent-red); border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 500">Import
                            en masse</button>
                    </div>
                    <div id="highTensionList"
                        style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 0.4rem">
                        <!-- Words will be added here -->
                    </div>
                </div>
                <!-- Medium Tension Words -->
                <div
                    style="background: var(--bg-secondary); border-radius: 8px; padding: 1.25rem; border: 2px solid rgba(230, 162, 60, 0.3)">
                    <h3
                        style="margin: 0 0 0.75rem 0; font-size: 1rem; color: #e6a23c; display: flex; align-items: center; gap: 0.5rem">
                        Tension moyenne
                        <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: normal">(+1.5
                            pts
                            chacun)</span>
                    </h3>
                    <div style="margin-bottom: 0.75rem">
                        <input type="text" id="mediumTensionInput" placeholder="Ajouter un mot..."
                            style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem"
                            onkeypress="if (event.key === 'Enter') addTensionWord('medium');" />
                        <button onclick="addTensionWord('medium')"
                            style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: #e6a23c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 500">+
                            Ajouter</button>
                        <button onclick="openBulkImport('medium')"
                            style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: rgba(230, 162, 60, 0.2); color: #e6a23c; border: 1px solid #e6a23c; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 500">Import
                            en masse</button>
                    </div>
                    <div id="mediumTensionList"
                        style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 0.4rem">
                        <!-- Words will be added here -->
                    </div>
                </div>
                <!-- Low Tension Words -->
                <div
                    style="background: var(--bg-secondary); border-radius: 8px; padding: 1.25rem; border: 2px solid rgba(74, 144, 226, 0.3)">
                    <h3
                        style="margin: 0 0 0.75rem 0; font-size: 1rem; color: var(--accent-blue); display: flex; align-items: center; gap: 0.5rem">
                        Faible tension
                        <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: normal">(-2 pts
                            chacun)</span>
                    </h3>
                    <div style="margin-bottom: 0.75rem">
                        <input type="text" id="lowTensionInput" placeholder="Ajouter un mot..."
                            style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem"
                            onkeypress="if (event.key === 'Enter') addTensionWord('low');" />
                        <button onclick="addTensionWord('low')"
                            style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: #2d6bb3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 500">+
                            Ajouter</button>
                        <button onclick="openBulkImport('low')"
                            style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; background: rgba(45, 107, 179, 0.15); color: #2d6bb3; border: 1px solid #2d6bb3; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 500">Import
                            en masse</button>
                    </div>
                    <div id="lowTensionList"
                        style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 0.4rem">
                        <!-- Words will be added here -->
                    </div>
                </div>
            </div>
            <div class="modal-actions" style="display: flex; justify-content: space-between; align-items: center">
                <div style="display: flex; gap: 0.75rem">
                    <button class="btn" onclick="exportTensionWords()"
                        style="background: #2d6bb3; color: white; border: 1px solid #2d6bb3">Exporter les
                        dictionnaires</button>
                    <button class="btn" onclick="resetTensionWordsToDefault()"
                        style="background: var(--accent-red); color: white">R√©initialiser aux valeurs par
                        d√©faut</button>
                </div>
                <div style="display: flex; gap: 0.75rem">
                    <button class="btn" onclick="closeModal('tensionWordsModal')"
                        data-i18n="btn.cancel">Annuler</button>
                    <button class="btn btn-primary" onclick="saveTensionWords()"><i data-lucide="save"></i>
                        <span data-i18n="btn.save">Enregistrer</span></button>
                </div>
            </div>
        </div>
    </div>
    <!-- Bulk Import Modal -->
    <div class="modal" id="bulkImportModal">
        <div class="modal-content" style="max-width: 700px">
            <div class="modal-title" id="bulkImportTitle">Import en masse</div>
            <div style="margin-bottom: 1.5rem">
                <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem">
                    Importez une liste de mots en masse. Vous pouvez :</p>
                <ul style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.8; padding-left: 1.5rem">
                    <li><strong>Coller du texte</strong> : Un mot par ligne ou s√©par√©s par des virgules</li>
                    <li><strong>Importer un fichier</strong> : Fichier .txt avec un mot par ligne</li>
                </ul>
            </div>
            <div style="margin-bottom: 1.5rem">
                <label class="form-label">Collez vos mots ici :</label>
                <textarea id="bulkImportText"
                    placeholder="Ex: combat, bataille, mort&#10;tuer, danger, peur&#10;terreur, cri, hurler"
                    style="width: 100%; min-height: 200px; padding: 0.75rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem; font-family: monospace; resize: vertical"> </textarea>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem">Formats accept√©s :
                    un
                    mot
                    par ligne, ou plusieurs mots s√©par√©s par des virgules</div>
            </div>
            <div style="margin-bottom: 1.5rem">
                <label class="form-label">Ou importez un fichier .txt :</label>
                <input type="file" id="bulkImportFile" accept=".txt"
                    style="width: 100%; padding: 0.5rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 0.85rem" />
            </div>
            <div
                style="padding: 1rem; background: rgba(74, 144, 226, 0.1); border-radius: 4px; border: 1px solid var(--accent-blue); margin-bottom: 1.5rem">
                <div style="font-size: 0.85rem; font-weight: 600; color: var(--accent-blue); margin-bottom: 0.5rem">
                    Mode
                    de fusion</div>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; margin-bottom: 0.5rem">
                    <input type="radio" name="importMode" value="add" checked />
                    <span style="font-size: 0.85rem; color: var(--text-primary)">Ajouter aux mots existants
                        (recommand√©)</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer">
                    <input type="radio" name="importMode" value="replace" />
                    <span style="font-size: 0.85rem; color: var(--text-primary)">Remplacer tous les mots
                        existants</span>
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('bulkImportModal')">Annuler</button>
                <button class="btn btn-primary" onclick="processBulkImport()"><i data-lucide="download"></i>
                    Importer
                    les mots</button>
            </div>
        </div>
    </div>
    <!-- References Panel Modal -->
    <div class="modal" id="referencesModal">
        <div class="modal-content" style="max-width: 700px">
            <div class="modal-title" id="referencesModalTitle" data-i18n="tools.links_title">R√©f√©rences et Liens
            </div>
            <div id="referencesModalContent"></div>
            <div class="modal-actions">
                <button class="btn" onclick="closeModal('referencesModal')">Fermer</button>
            </div>
        </div>
    </div>
    <!-- Annotation Popup -->
    <div class="annotation-popup" id="annotationPopup">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem">
            <h3 style="margin: 0" data-i18n="revision.popup.title">Ajouter une annotation</h3>
            <button class="btn-info-circle" onclick="RevisionView.toggleAnnotationGuide()" title="Aide sur les types"
                data-i18n-title="revision.popup.help">
                <i data-lucide="help-circle"></i>
            </button>
        </div>

        <!-- Annotation Guide (Hidden by default) -->
        <div id="annotationGuide" class="annotation-guide hidden">
            <div class="guide-item">
                <span class="guide-tag comment" data-i18n="revision.type.comment">Commentaire</span>
                <p data-i18n="revision.guide.comment_desc">Impressions de lecture ou feedback g√©n√©ral.</p>
            </div>
            <div class="guide-item">
                <span class="guide-tag todo" data-i18n="revision.type.todo">TODO</span>
                <p data-i18n="revision.guide.todo_desc">T√¢che concr√®te √† r√©aliser (corriger, supprimer,
                    r√©√©crire).
                </p>
            </div>
            <div class="guide-item">
                <span class="guide-tag note" data-i18n="revision.type.note">Note</span>
                <p data-i18n="revision.guide.note_desc">Remarque cr√©ative, id√©e de d√©veloppement ou rappel.</p>
            </div>
            <div class="guide-item">
                <span class="guide-tag question" data-i18n="revision.type.question">Question</span>
                <p data-i18n="revision.guide.question_desc">Doute logique, incoh√©rence ou point √† v√©rifier.</p>
            </div>
        </div>

        <div class="annotation-type-selector">
            <div class="annotation-type-btn comment active" onclick="selectAnnotationType('comment')"><i
                    data-lucide="message-circle"></i><span data-i18n="revision.type.comment">Commentaire</span>
            </div>
            <div class="annotation-type-btn todo" onclick="selectAnnotationType('todo')"><i
                    data-lucide="check-square"></i><span data-i18n="revision.type.todo">TODO</span></div>
            <div class="annotation-type-btn note" onclick="selectAnnotationType('note')"><i
                    data-lucide="sticky-note"></i><span data-i18n="revision.type.note">Note</span></div>
            <div class="annotation-type-btn question" onclick="selectAnnotationType('question')"><i
                    data-lucide="help-circle"></i><span data-i18n="revision.type.question">Question</span></div>
        </div>
        <textarea id="annotationText" placeholder="Votre annotation..."
            data-i18n-placeholder="revision.popup.placeholder"></textarea>
        <div class="modal-actions">
            <button class="btn" onclick="closeAnnotationPopup()" data-i18n="btn.cancel">Annuler</button>
            <button class="btn btn-primary" onclick="saveAnnotation()" data-i18n="btn.save">Enregistrer</button>
        </div>
    </div>
    <!-- Floating Editor Menu Toggle Button (Mobile) -->
    <button id="floatingEditorToggle" title="Activer/D√©sactiver l'√©diteur flottant"
        data-i18n-title="floating.title.toggle"><i data-lucide="pen-line"></i></button>
    <!-- Floating Editor Menu (Mobile) -->
    <div id="floatingEditorMenu">
        <div id="floatingMenuHandle" title="Faire glisser pour d√©placer" data-i18n-title="floating.title.drag">
        </div>
        <div id="floatingMenuContent">
            <!-- Annuler/R√©tablir -->
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="undo()" title="Annuler"
                data-i18n-title="floating.title.undo">
                <i data-lucide="undo-2"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="redo()" title="R√©tablir"
                data-i18n-title="floating.title.redo">
                <i data-lucide="redo-2"></i>
            </button>
            <div class="floating-divider"></div>
            <!-- Formatage de base -->
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('bold')"
                title="Gras" data-i18n-title="floating.title.bold">
                <i data-lucide="bold"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('italic')"
                title="Italique" data-i18n-title="floating.title.italic">
                <i data-lucide="italic"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('underline')"
                title="Soulign√©" data-i18n-title="floating.title.underline">
                <i data-lucide="underline"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('strikeThrough')"
                title="Barr√©" data-i18n-title="floating.title.strikethrough">
                <i data-lucide="strikethrough"></i>
            </button>
            <div class="floating-divider"></div>
            <!-- Alignement -->
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('justifyLeft')"
                title="Aligner √† gauche" data-i18n-title="floating.title.align_left">
                <i data-lucide="align-left"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('justifyCenter')"
                title="Centrer" data-i18n-title="floating.title.center">
                <i data-lucide="align-center"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('justifyRight')"
                title="Aligner √† droite" data-i18n-title="floating.title.align_right">
                <i data-lucide="align-right"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('justifyFull')"
                title="Justifier" data-i18n-title="floating.title.justify">
                <i data-lucide="align-justify"></i>
            </button>
            <div class="floating-divider"></div>
            <!-- Listes -->
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('insertUnorderedList')" title="Liste √† puces"
                data-i18n-title="floating.title.unordered_list">
                <i data-lucide="list"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('insertOrderedList')" title="Liste num√©rot√©e"
                data-i18n-title="floating.title.ordered_list">
                <i data-lucide="list-ordered"></i>
            </button>
            <div class="floating-divider"></div>
            <!-- Plus d'options - Toggle sous-menu -->
            <button class="floating-btn-mini" id="advancedMenuBtn" onmousedown="event.preventDefault()"
                title="Plus d'options" data-i18n-title="floating.title.more_options">
                <i data-lucide="more-horizontal"></i>
            </button>
        </div>
        <!-- Barre de sous-menu avanc√© (appara√Æt au-dessus gr√¢ce √† column-reverse) -->
        <div id="advancedMenuBar" style="display: none">
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="formatText('removeFormat')"
                title="Supprimer le formatage" data-i18n-title="floating.title.remove_format">
                <i data-lucide="eraser"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()" onclick="insertLink()"
                title="Ins√©rer un lien" data-i18n-title="floating.title.insert_link">
                <i data-lucide="link" style="width: 16px; height: 16px"></i>
            </button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('formatBlock', 'h1')" title="Titre 1"
                data-i18n-title="floating.title.h1">H1</button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('formatBlock', 'h2')" title="Titre 2"
                data-i18n-title="floating.title.h2">H2</button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('formatBlock', 'h3')" title="Titre 3"
                data-i18n-title="floating.title.h3">H3</button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('formatBlock', 'blockquote')" title="Citation"
                data-i18n-title="floating.title.blockquote" data-i18n="floating.title.blockquote">Citation</button>
            <button class="floating-btn-mini" onmousedown="event.preventDefault()"
                onclick="formatText('insertHorizontalRule')" title="Ligne horizontale"
                data-i18n-title="floating.title.horizontal_rule" data-i18n="floating.label.line">Ligne</button>
        </div>
    </div>
    <!-- Keyboard Shortcuts Summary Modal -->
    <div class="shortcuts-modal" id="shortcutsModal">
        <div class="shortcuts-modal-content">
            <div class="shortcuts-modal-header">
                <div class="shortcuts-modal-title">
                    <i data-lucide="keyboard"></i>
                    <span data-i18n="shortcuts.title">Raccourcis clavier</span>
                </div>
                <button class="shortcuts-modal-close" onclick="KeyboardShortcutsHandlers.closeShortcutsModal()"
                    title="Fermer" data-i18n-title="btn.close">
                    <i data-lucide="x" style="width: 20px; height: 20px"></i>
                </button>
            </div>
            <div class="shortcuts-tabs">
                <div class="shortcuts-tab active" id="tabKeyboardShortcuts"
                    onclick="KeyboardShortcutsHandlers.switchTab('keyboard')" data-i18n="shortcuts.tab.keyboard">
                    <i data-lucide="keyboard" style="width: 16px; height: 16px"></i>
                    Clavier
                </div>
                <div class="shortcuts-tab" id="tabMobileShortcuts"
                    onclick="KeyboardShortcutsHandlers.switchTab('mobile')" data-i18n="shortcuts.tab.mobile">
                    <i data-lucide="smartphone" style="width: 16px; height: 16px"></i>
                    Tactile (Mobile)
                </div>
            </div>
            <div class="shortcuts-modal-body active" id="bodyKeyboardShortcuts">
                <!-- Section : G√©n√©ral -->
                <div class="shortcut-category">
                    <div class="shortcut-category-title" data-i18n="shortcuts.cat.general">
                        <i data-lucide="command" style="width: 14px; height: 14px"></i>
                        G√©n√©ral
                    </div>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.open_summary">Ouvrir ce
                                r√©sum√©</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">?</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.global_search">Recherche
                                globale</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">F</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.save_project">Sauvegarder
                                le
                                projet</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">S</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.focus_mode">Mode Focus
                                (Plein
                                √©cran)</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">F11</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.revision_mode">Mode
                                R√©vision</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">R</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section : √âcriture -->
                <div class="shortcut-category">
                    <div class="shortcut-category-title" data-i18n="shortcuts.cat.writing">
                        <i data-lucide="pen-tool" style="width: 14px; height: 14px"></i>
                        √âcriture
                    </div>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.new_paragraph">Nouveau
                                paragraphe</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Entr√©e</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.line_break">Saut de
                                ligne</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Maj</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Entr√©e</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.non_breaking_space">Espace
                                ins√©cable</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Maj</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Espace</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.french_quote_open">Guillemet
                                fran√ßais ouvert ( ¬´ )</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Z</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.french_quote_close">Guillemet
                                fran√ßais ferm√© ( ¬ª )</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">X</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.em_dash">Tiret cadratin
                                ( ‚Äî
                                )</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Maj</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section : Style du texte -->
                <div class="shortcut-category">
                    <div class="shortcut-category-title" data-i18n="shortcuts.cat.text_style"><i data-lucide="type"
                            style="width: 14px; height: 14px"></i>
                        Style du texte</div>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.bold">Mettre en
                                gras</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">B</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.italic">Mettre en
                                italique</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">I</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.underline">Souligner</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">U</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section : Presse-papier -->
                <div class="shortcut-category">
                    <div class="shortcut-category-title" data-i18n="shortcuts.cat.editing">
                        <i data-lucide="clipboard" style="width: 14px; height: 14px"></i>
                        √âdition
                    </div>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.undo">Annuler</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Z</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.redo">R√©tablir</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Y</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.cut">Couper</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">X</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.copy">Copier</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">C</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.paste">Coller</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">V</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.paste_no_format">Coller
                                sans
                                mise en forme</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Maj</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">V</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section : Navigation & Menus -->
                <div class="shortcut-category">
                    <div class="shortcut-category-title" data-i18n="shortcuts.cat.navigation">
                        <i data-lucide="move" style="width: 14px; height: 14px"></i>
                        Navigation & Menus
                    </div>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.close_cancel">Fermer la
                                fen√™tre
                                / Annuler</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">√âchap</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.validate_ok">Valider /
                                OK</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Entr√©e</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.line_start_end">D√©but /
                                Fin
                                de
                                ligne</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Origine</span>
                                <span class="shortcut-plus">/</span>
                                <span class="shortcut-key">Fin</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-description" data-i18n="shortcuts.desc.doc_start_end">D√©but /
                                Fin
                                du
                                document</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">Origine</span>
                                <span class="shortcut-plus">/</span>
                                <span class="shortcut-key">Fin</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB : Mobile Swipe Gestures -->
            <div class="shortcuts-modal-body" id="bodyMobileShortcuts">
                <div class="shortcut-category">
                    <div class="shortcut-category-title" data-i18n="shortcuts.cat.gestures"><i data-lucide="hand"
                            style="width: 14px; height: 14px"></i>
                        Gestes Tactiles</div>
                    <div class="shortcut-list" id="mobileGestureList">
                        <div class="gesture-item">
                            <div class="gesture-icon">
                                <i data-lucide="arrow-right-to-line"></i>
                            </div>
                            <div class="gesture-info">
                                <span class="gesture-name" data-i18n="shortcuts.desc.open_sidebar">Ouvrir la
                                    barre
                                    lat√©rale</span>
                                <span class="gesture-description" data-i18n="shortcuts.desc.open_sidebar_detail">Glisser
                                    depuis le bord gauche vers la droite</span>
                            </div>
                        </div>
                        <div class="gesture-item">
                            <div class="gesture-icon">
                                <i data-lucide="arrow-left-to-line"></i>
                            </div>
                            <div class="gesture-info">
                                <span class="gesture-name" data-i18n="shortcuts.desc.close_sidebar">Fermer la
                                    barre
                                    lat√©rale</span>
                                <span class="gesture-description"
                                    data-i18n="shortcuts.desc.close_sidebar_detail">Glisser vers la gauche
                                    n'importe
                                    o√π</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="shortcuts-modal-footer"
                style="padding: 1rem 2rem; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-muted); font-size: 0.8rem"
                data-i18n="shortcuts.footer">
                Certains raccourcis peuvent varier selon votre syst√®me d'exploitation.</div>
        </div>
    </div>
    <!-- Hidden input for project import -->
    <input type="file" id="importProjectFile" style="display: none" onchange="ProjectViewModel.import(this.files[0])"
        accept=".json">
</body>
    <!-- Generated JS Scripts -->
    <script src="./js/vendor/driver.js.iife.js"></script>
<script src="./js/vendor/docx.js"></script>
<script src="./js/vendor/idb.js"></script>
<script src="./js/01.app.refactor.js"></script>
<script src="./js/localization/locales/fr.js"></script>
<script src="./js/localization/locales/en.js"></script>
<script src="./js/localization/locales/de.js"></script>
<script src="./js/localization/locales/es.js"></script>
<script src="./js/localization/localization.model.js"></script>
<script src="./js/localization/localization.view.js"></script>
<script src="./js/localization/localization.manager.js"></script>
<script src="./js/localization/landing-locales.js"></script>
<script src="./js/tension/tension.model.js"></script>
<script src="./js/tension/tension.repository.js"></script>
<script src="./js/tension/tension.viewmodel.js"></script>
<script src="./js/tension/tension.view.js"></script>
<script src="./js/tension/tension.handlers.js"></script>
<script src="./js/tension/tension.main.js"></script>
<script src="./js/storage/storage.model.js"></script>
<script src="./js/storage/storage.repository.js"></script>
<script src="./js/storage/storage.viewmodel.js"></script>
<script src="./js/storage/storage.view.js"></script>
<script src="./js/storage/storage.main.js"></script>
<script src="./js/project/project.model.js"></script>
<script src="./js/project/project.repository.js"></script>
<script src="./js/project/project.templates.js"></script>
<script src="./js/project/project.viewmodel.js"></script>
<script src="./js/project/project.view.js"></script>
<script src="./js/project/project.handlers.js"></script>
<script src="./js/project/project.main.js"></script>
<script src="./js/floating-editor/floating-editor.model.js"></script>
<script src="./js/floating-editor/floating-editor.repository.js"></script>
<script src="./js/floating-editor/floating-editor.view.js"></script>
<script src="./js/floating-editor/floating-editor.viewmodel.js"></script>
<script src="./js/floating-editor/floating-editor.handlers.js"></script>
<script src="./js/floating-editor/floating-editor.main.js"></script>
<script src="./js/interface-customizer/interface-customizer.model.js"></script>
<script src="./js/interface-customizer/interface-customizer.repository.js"></script>
<script src="./js/interface-customizer/interface-customizer.viewmodel.js"></script>
<script src="./js/interface-customizer/interface-customizer.view.js"></script>
<script src="./js/04.init.js"></script>
<script src="./js/undo-redo/undo-redo.model.js"></script>
<script src="./js/undo-redo/undo-redo.repository.js"></script>
<script src="./js/undo-redo/undo-redo.viewmodel.js"></script>
<script src="./js/undo-redo/undo-redo.view.js"></script>
<script src="./js/undo-redo/undo-redo.handlers.js"></script>
<script src="./js/undo-redo/undo-redo.main.js"></script>
<script src="./js/pagination.js"></script>
<script src="./js/structure/structure.model.js"></script>
<script src="./js/structure/structure.repository.js"></script>
<script src="./js/structure/structure.viewmodel.js"></script>
<script src="./js/00.app.view.js"></script>
<script src="./js/tools-sidebar.viewmodel.js"></script>
<script src="./js/structure/structure.view.js"></script>
<script src="./js/structure/structure-organizer.view.js"></script>
<script src="./js/structure/structure.helpers.js"></script>
<script src="./js/stats/stats.model.js"></script>
<script src="./js/stats/stats.repository.js"></script>
<script src="./js/stats/stats.viewmodel.js"></script>
<script src="./js/stats/stats.view.js"></script>
<script src="./js/stats/stats.main.js"></script>
<script src="./js/auto-detect/auto-detect.model.js"></script>
<script src="./js/auto-detect/auto-detect.repository.js"></script>
<script src="./js/auto-detect/auto-detect.viewmodel.js"></script>
<script src="./js/auto-detect/auto-detect.view.js"></script>
<script src="./js/auto-detect/auto-detect.handlers.js"></script>
<script src="./js/auto-detect/auto-detect.main.js"></script>
<script src="./js/colorpalette/color-palette.model.js"></script>
<script src="./js/colorpalette/color-palette.repository.js"></script>
<script src="./js/colorpalette/color-palette.viewmodel.js"></script>
<script src="./js/colorpalette/color-palette.view.js"></script>
<script src="./js/colorpalette/color-palette.handlers.js"></script>
<script src="./js/colorpalette/color-palette.main.js"></script>
<script src="./js/mobile-menu/mobile-menu.model.js"></script>
<script src="./js/mobile-menu/mobile-menu.repository.js"></script>
<script src="./js/mobile-menu/mobile-menu.viewmodel.js"></script>
<script src="./js/mobile-menu/mobile-menu.view.js"></script>
<script src="./js/mobile-menu/mobile-menu.main.js"></script>
<script src="./js/dragndrop-acts/dragndrop-acts.model.js"></script>
<script src="./js/dragndrop-acts/dragndrop-acts.repository.js"></script>
<script src="./js/dragndrop-acts/dragndrop-acts.viewmodel.js"></script>
<script src="./js/dragndrop-acts/dragndrop-acts.view.js"></script>
<script src="./js/dragndrop-acts/dragndrop-acts.handlers.js"></script>
<script src="./js/dragndrop-acts/dragndrop-acts.main.js"></script>
<script src="./js/characters/characters.model.js"></script>
<script src="./js/characters/characters.repository.js"></script>
<script src="./js/characters/characters.viewmodel.js"></script>
<script src="./js/characters/characters.view.js"></script>
<script src="./js/splitview/splitview.model.js"></script>
<script src="./js/splitview/splitview.repository.js"></script>
<script src="./js/splitview/splitview.viewmodel.js"></script>
<script src="./js/splitview/splitview.view.js"></script>
<script src="./js/splitview/splitview.coordinator.js"></script>
<script src="./js/splitview/splitview.handlers.js"></script>
<script src="./js/splitview/splitview.main.js"></script>
<script src="./js/tabs/tabs.repository.js"></script>
<script src="./js/tabs/tabs.viewmodel.js"></script>
<script src="./js/tabs/tabs.view.js"></script>
<script src="./js/tabs/tabs.main.js"></script>
<script src="./js/world/world.model.js"></script>
<script src="./js/world/world.repository.js"></script>
<script src="./js/world/world.viewmodel.js"></script>
<script src="./js/world/world.view.js"></script>
<script src="./js/18.timeline.js"></script>
<script src="./js/notes/notes.model.js"></script>
<script src="./js/notes/notes.repository.js"></script>
<script src="./js/notes/notes.viewmodel.js"></script>
<script src="./js/notes/notes.view.js"></script>
<script src="./js/notes/notes.handlers.js"></script>
<script src="./js/notes/notes.main.js"></script>
<script src="./js/snapshots/snapshots.model.js"></script>
<script src="./js/snapshots/snapshots.repository.js"></script>
<script src="./js/snapshots/snapshots.viewmodel.js"></script>
<script src="./js/snapshots/snapshots.view.js"></script>
<script src="./js/snapshots/snapshots.main.js"></script>
<script src="./js/sceneVersion/sceneVersion.model.js"></script>
<script src="./js/sceneVersion/sceneVersion.repository.js"></script>
<script src="./js/sceneVersion/sceneVersion.viewmodel.js"></script>
<script src="./js/sceneVersion/sceneVersion.view.js"></script>
<script src="./js/sceneVersion/sceneVersion.main.js"></script>
<script src="./js/diff/diff.model.js"></script>
<script src="./js/diff/diff.repository.js"></script>
<script src="./js/diff/diff.viewmodel.js"></script>
<script src="./js/diff/diff.view.js"></script>
<script src="./js/diff/diff.handlers.js"></script>
<script src="./js/diff/diff.main.js"></script>
<script src="./js/codex/codex.model.js"></script>
<script src="./js/codex/codex.repository.js"></script>
<script src="./js/codex/codex.viewmodel.js"></script>
<script src="./js/codex/codex.view.js"></script>
<script src="./js/search/search.model.js"></script>
<script src="./js/search/search.repository.js"></script>
<script src="./js/search/search.viewmodel.js"></script>
<script src="./js/search/search.view.js"></script>
<script src="./js/search/search.handlers.js"></script>
<script src="./js/search/search.main.js"></script>
<script src="./js/focusMode/focusMode.model.js"></script>
<script src="./js/focusMode/focusMode.repository.js"></script>
<script src="./js/focusMode/focusMode.viewmodel.js"></script>
<script src="./js/focusMode/focusMode.view.js"></script>
<script src="./js/focusMode/focusMode.handlers.js"></script>
<script src="./js/focusMode/focusMode.main.js"></script>
<script src="./js/keyboard-shortcuts/keyboard-shortcuts.model.js"></script>
<script src="./js/keyboard-shortcuts/keyboard-shortcuts.repository.js"></script>
<script src="./js/keyboard-shortcuts/keyboard-shortcuts.viewmodel.js"></script>
<script src="./js/keyboard-shortcuts/keyboard-shortcuts.view.js"></script>
<script src="./js/keyboard-shortcuts/keyboard-shortcuts.handlers.js"></script>
<script src="./js/keyboard-shortcuts/keyboard-shortcuts.main.js"></script>
<script src="./js/revision/revision.model.js"></script>
<script src="./js/revision/revision.repository.js"></script>
<script src="./js/revision/revision.viewmodel.js"></script>
<script src="./js/revision/revision.view.js"></script>
<script src="./js/revision/revision.handlers.js"></script>
<script src="./js/revision/revision.main.js"></script>
<script src="./js/mention-help/mention-help.model.js"></script>
<script src="./js/mention-help/mention-help.repository.js"></script>
<script src="./js/mention-help/mention-help.viewmodel.js"></script>
<script src="./js/mention-help/mention-help.view.js"></script>
<script src="./js/mention-help/mention-help.handlers.js"></script>
<script src="./js/mention-help/mention-help.main.js"></script>
<script src="./js/todo/todo.model.js"></script>
<script src="./js/todo/todo.repository.js"></script>
<script src="./js/todo/todo.viewmodel.js"></script>
<script src="./js/todo/todo.view.js"></script>
<script src="./js/todo/todo.handlers.js"></script>
<script src="./js/todo/todo.main.js"></script>
<script src="./js/corkboard/corkboard.model.js"></script>
<script src="./js/corkboard/corkboard.repository.js"></script>
<script src="./js/corkboard/corkboard.viewmodel.js"></script>
<script src="./js/corkboard/corkboard.view.js"></script>
<script src="./js/corkboard/corkboard.handlers.js"></script>
<script src="./js/corkboard/corkboard.main.js"></script>
<script src="./js/mindmap/mindmap.model.js"></script>
<script src="./js/mindmap/mindmap.repository.js"></script>
<script src="./js/mindmap/mindmap.viewmodel.js"></script>
<script src="./js/mindmap/mindmap.view.js"></script>
<script src="./js/mindmap/mindmap.handlers.js"></script>
<script src="./js/mindmap/mindmap.main.js"></script>
<script src="./js/plot/plot.model.js"></script>
<script src="./js/plot/plot.repository.js"></script>
<script src="./js/plot/plot.viewmodel.js"></script>
<script src="./js/plot/plot.view.js"></script>
<script src="./js/plot/plot.init.js"></script>
<script src="./js/relation-map/relation-map.model.js"></script>
<script src="./js/relation-map/relation-map.repository.js"></script>
<script src="./js/relation-map/relation-map.viewmodel.js"></script>
<script src="./js/relation-map/relation-map.view.js"></script>
<script src="./js/relation-map/relation-map.handlers.js"></script>
<script src="./js/relation-map/relation-map.main.js"></script>
<script src="./js/map/map.model.js"></script>
<script src="./js/map/map.repository.js"></script>
<script src="./js/map/map.viewmodel.js"></script>
<script src="./js/map/map.view.js"></script>
<script src="./js/map/map.handlers.js"></script>
<script src="./js/map/map.main.js"></script>
<script src="./js/timeline-metro/timeline-metro.model.js"></script>
<script src="./js/timeline-metro/timeline-metro.repository.js"></script>
<script src="./js/timeline-metro/timeline-metro.viewmodel.js"></script>
<script src="./js/timeline-metro/timeline-metro.view.js"></script>
<script src="./js/timeline-metro/timeline-metro.handlers.js"></script>
<script src="./js/timeline-metro/timeline-metro.main.js"></script>
<script src="./js/theme-manager/theme-manager.model.js"></script>
<script src="./js/theme-manager/theme-manager.repository.js"></script>
<script src="./js/theme-manager/theme-manager.viewmodel.js"></script>
<script src="./js/theme-manager/theme-manager.view.js"></script>
<script src="./js/theme-manager/theme-manager.main.js"></script>
<script src="./js/import-export/import-export.model.js"></script>
<script src="./js/import-export/docx-export.config.js"></script>
<script src="./js/import-export/import-export.repository.js"></script>
<script src="./js/import-export/google-drive.service.js"></script>
<script src="./js/import-export/import-export.viewmodel.js"></script>
<script src="./js/import-export/import-export.view.js"></script>
<script src="./js/import-export/import-export.handlers.js"></script>
<script src="./js/import-export/import-export.main.js"></script>
<script src="./js/front-matter/front-matter.model.js"></script>
<script src="./js/front-matter/front-matter.repository.js"></script>
<script src="./js/front-matter/front-matter.viewmodel.js"></script>
<script src="./js/front-matter/front-matter.view.js"></script>
<script src="./js/front-matter/front-matter.main.js"></script>
<script src="./js/sidebar-view/sidebar-view.model.js"></script>
<script src="./js/sidebar-view/sidebar-view.repository.js"></script>
<script src="./js/sidebar-view/sidebar-view.viewmodel.js"></script>
<script src="./js/sidebar-view/sidebar-view.view.js"></script>
<script src="./js/sidebar-view/sidebar-view.main.js"></script>
<script src="./js/storageMonitoring/storageMonitoring.model.js"></script>
<script src="./js/storageMonitoring/storageMonitoring.repository.js"></script>
<script src="./js/storageMonitoring/storageMonitoring.viewmodel.js"></script>
<script src="./js/storageMonitoring/storageMonitoring.view.js"></script>
<script src="./js/storageMonitoring/storageMonitoring.main.js"></script>
<script src="./js/mobile-swipe/mobile-swipe.model.js"></script>
<script src="./js/mobile-swipe/mobile-swipe.repository.js"></script>
<script src="./js/mobile-swipe/mobile-swipe.viewmodel.js"></script>
<script src="./js/mobile-swipe/mobile-swipe.view.js"></script>
<script src="./js/mobile-swipe/mobile-swipe.handlers.js"></script>
<script src="./js/mobile-swipe/mobile-swipe.main.js"></script>
<script src="./js/arc-board/arc-board.config.js"></script>
<script src="./js/arc-board/arc-board.models.js"></script>
<script src="./js/arc-board/arc-board.repository.js"></script>
<script src="./js/arc-board/arc-board.viewmodel.js"></script>
<script src="./js/arc-board/arc-board.services.js"></script>
<script src="./js/arc-board/arc-board.views.js"></script>
<script src="./js/arc-board/arc-board.handlers.js"></script>
<script src="./js/arc-board/index.js"></script>
<script src="./js/arc-board/arc-board.main.js"></script>
<script src="./js/plotgrid/plot-grid.model.js"></script>
<script src="./js/plotgrid/plot-grid.repository.js"></script>
<script src="./js/plotgrid/plot-grid.viewmodel.js"></script>
<script src="./js/plotgrid/plot-grid.import-export.js"></script>
<script src="./js/plotgrid/plot-grid.view.js"></script>
<script src="./js/sceneNavigation/scene-navigation.model.js"></script>
<script src="./js/sceneNavigation/scene-navigation.repository.js"></script>
<script src="./js/sceneNavigation/scene-navigation.viewmodel.js"></script>
<script src="./js/sceneNavigation/scene-navigation.view.js"></script>
<script src="./js/sceneNavigation/scene-navigation.handlers.js"></script>
<script src="./js/sceneNavigation/scene-navigation.main.js"></script>
<script src="./js/synonyms/synonyms.config.js"></script>
<script src="./js/synonyms/synonyms.model.js"></script>
<script src="./js/synonyms/synonyms.dictionary.js"></script>
<script src="./js/synonyms/synonyms.service.js"></script>
<script src="./js/synonyms/synonyms.repository.js"></script>
<script src="./js/synonyms/synonyms.viewmodel.js"></script>
<script src="./js/synonyms/synonyms.view.js"></script>
<script src="./js/import-chapter/import-chapter.model.js"></script>
<script src="./js/import-chapter/import-chapter.viewmodel.js"></script>
<script src="./js/import-chapter/import-chapter.view.js"></script>
<script src="./js/word-repetition/word-repetition.model.js"></script>
<script src="./js/word-repetition/word-repetition.repository.js"></script>
<script src="./js/word-repetition/word-repetition.viewmodel.js"></script>
<script src="./js/word-repetition/word-repetition.view.js"></script>
<script src="./js/word-repetition/word-repetition.handlers.js"></script>
<script src="./js/word-repetition/word-repetition.main.js"></script>
<script src="./js/product-tour/product-tour.model.js"></script>
<script src="./js/product-tour/product-tour.data.js"></script>
<script src="./js/product-tour/product-tour.repository.js"></script>
<script src="./js/product-tour/product-tour.viewmodel.js"></script>
<script src="./js/product-tour/product-tour.view.js"></script>
<script src="./js/product-tour/product-tour.editor.view.js"></script>
<script src="./js/product-tour/product-tour.editor.viewmodel.js"></script>
<script src="./js/product-tour/product-tour.handlers.js"></script>
<script src="./js/product-tour/product-tour.main.js"></script>
<script src="./js/investigation-board/investigation-board.model.js"></script>
<script src="./js/investigation-board/investigation-board.store.js"></script>
<script src="./js/investigation-board/investigation-board.dashboard.js"></script>
<script src="./js/investigation-board/investigation-board.registry.js"></script>
<script src="./js/investigation-board/investigation-board.matrix.js"></script>
<script src="./js/investigation-board/investigation-board.mmo.js"></script>
<script src="./js/investigation-board/investigation-board.timeline.js"></script>
<script src="./js/investigation-board/investigation-board.demo.js"></script>
<script src="./js/investigation-board/investigation-board.sidebar.js"></script>
<script src="./js/investigation-board/investigation-board.view.js"></script>
<script src="./js/globalnotes/globalnotes.model.js"></script>
<script src="./js/globalnotes/globalnotes.repository.js"></script>
<script src="./js/globalnotes/globalnotes.viewmodel.js"></script>
<script src="./js/globalnotes/globalnotes.view.js"></script>
<script src="./js/globalnotes/globalnotes.item.view.js"></script>
<script src="./js/globalnotes/globalnotes.handlers.js"></script>
<script src="./js/globalnotes/globalnotes.main.js"></script>

    </body>
</html>
